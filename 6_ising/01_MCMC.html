
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ising models and Metropolis-Hastings algorithm &#8212; Statistical Mechanics for Chemistry and Biology</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Phase transitions through the lense of Ising models" href="02_ising_analytic.html" />
    <link rel="prev" title="Phase transitions" href="intro.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.jpg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Statistical Mechanics for Chemistry and Biology</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   About
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../0_python/intro.html">
   Python
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../0_python/intro2py.html">
     Python3
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../0_python/intro2numpy.html">
     NumPy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../0_python/intro2viz.html">
     Plotting
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../1_stats/intro.html">
   Stats
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_stats/01_SetsCounting.html">
     Probability by counting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_stats/02_RandVar.html">
     Random variable, stochastic process and simulation.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_stats/02_Diffusion.html">
     Brownian motion and Diffusion
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_stats/03_MC.html">
     Monte Carlo and “the power of randomness”
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_stats/RW_theory.html">
     Appendix A: Large N approximations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_stats/04_LimitTheorems.html">
     Appendix B: Limit theorems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_stats/05_InverseTransform.html">
     Appendix C: The Inverse Transform of RVs
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../2_thermo/intro.html">
   Thermodynamics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_thermo/01_Thermo.html">
     Review of thermodynamics principles
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_thermo/02_Legendre.html">
     Legendre transform
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Chapters
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../3_ensembles/intro.html">
   Ensembles
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../3_ensembles/phase_space.html">
     Phase Space
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../3_ensembles/nve.html">
     NVE
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../3_ensembles/nvt.html">
     NVT
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../3_ensembles/npt.html">
     <span class="math notranslate nohighlight">
      \(\mu V T\)
     </span>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../3_ensembles/ensemble_overview.html">
     Overview of ensembles
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../4_ideal_systems/intro.html">
   Gases
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../4_ideal_systems/quantum_systems.html">
     Quantum non-interacting systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../4_ideal_systems/photons_phonons.html">
     Photons and Phonons
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../5_entropy/intro.html">
   Entropy
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../5_entropy/shannon.html">
     What is Information?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../5_entropy/landauer.html">
     Information erasure and Landauer’s principle
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="intro.html">
   Phase transitions
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Ising models and Metropolis-Hastings algorithm
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02_ising_analytic.html">
     Phase transitions through the lense of Ising models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_MeanField.html">
     Mean Field Theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04_EnhanceSampl.html">
     Non-boltzman (enhanced) sampling ideas
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../7_fluids/intro.html">
   Fluids
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../7_fluids/Intro2Fluids.html">
     Introduction to statistical mechanics of fluids
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../7_fluids/mc_lj.html">
     Monte Carlo simulations of Lennard-Jones fluids
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/6_ising/01_MCMC.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/DPotoyan/Statmech4ChemBio/master?urlpath=lab/tree/6_ising/01_MCMC.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/DPotoyan/Statmech4ChemBio/blob/master/6_ising/01_MCMC.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#thermodynamics-of-ising-models">
   Thermodynamics of Ising models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#magnetization">
     Magnetization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#heat-capacity-c-v">
     Heat capacity
     <span class="math notranslate nohighlight">
      \(C_v\)
     </span>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#susceptibility-chi">
     Susceptibility
     <span class="math notranslate nohighlight">
      \(\chi\)
     </span>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#free-energy-profile">
   Free energy profile
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#numerical-calculation-of-thermodynamic-quantities">
   Numerical calculation of thermodynamic quantities
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#enforcing-periodic-boundary-conditions">
   Enforcing periodic boundary conditions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sampling-of-boltzmann-distribution-mc-vs-mcmc">
   Sampling of Boltzmann distribution: MC vs MCMC
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generating-chains-master-equation-and-detailed-balance">
   Generating chains! Master Equation and Detailed Balance
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#detailed-balance-equilibrium">
   Detailed Balance = Equilibrium
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-pick-the-moves-for-markov-chain">
   How to pick the moves for Markov chain?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#metropolis-algorithm">
   Metropolis algorithm
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#code-for-running-2d-ising-mcmc-simulations">
     Code for running 2D ising MCMC Simulations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#carry-out-explorative-simulations">
     Carry out explorative simulations
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#parameter-sweeps-and-calculation-of-second-order-thermodynamic-quantities">
       Parameter sweeps and calculation of second order thermodynamic quantities
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#problems">
     Problems
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#problem-1">
       Problem-1
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#problem-2">
       Problem-2
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#problem-3">
       Problem-3
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#problem-4">
       Problem-4
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Ising models and Metropolis-Hastings algorithm</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#thermodynamics-of-ising-models">
   Thermodynamics of Ising models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#magnetization">
     Magnetization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#heat-capacity-c-v">
     Heat capacity
     <span class="math notranslate nohighlight">
      \(C_v\)
     </span>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#susceptibility-chi">
     Susceptibility
     <span class="math notranslate nohighlight">
      \(\chi\)
     </span>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#free-energy-profile">
   Free energy profile
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#numerical-calculation-of-thermodynamic-quantities">
   Numerical calculation of thermodynamic quantities
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#enforcing-periodic-boundary-conditions">
   Enforcing periodic boundary conditions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sampling-of-boltzmann-distribution-mc-vs-mcmc">
   Sampling of Boltzmann distribution: MC vs MCMC
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generating-chains-master-equation-and-detailed-balance">
   Generating chains! Master Equation and Detailed Balance
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#detailed-balance-equilibrium">
   Detailed Balance = Equilibrium
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-pick-the-moves-for-markov-chain">
   How to pick the moves for Markov chain?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#metropolis-algorithm">
   Metropolis algorithm
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#code-for-running-2d-ising-mcmc-simulations">
     Code for running 2D ising MCMC Simulations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#carry-out-explorative-simulations">
     Carry out explorative simulations
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#parameter-sweeps-and-calculation-of-second-order-thermodynamic-quantities">
       Parameter sweeps and calculation of second order thermodynamic quantities
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#problems">
     Problems
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#problem-1">
       Problem-1
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#problem-2">
       Problem-2
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#problem-3">
       Problem-3
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#problem-4">
       Problem-4
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="ising-models-and-metropolis-hastings-algorithm">
<h1>Ising models and Metropolis-Hastings algorithm<a class="headerlink" href="#ising-models-and-metropolis-hastings-algorithm" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">rand</span><span class="p">,</span> <span class="n">random</span><span class="p">,</span> <span class="n">randint</span><span class="p">,</span> <span class="n">choice</span><span class="p">,</span> <span class="n">normal</span><span class="p">,</span> <span class="n">uniform</span> 
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Ising models are a class of simple lattice based spin <span class="math notranslate nohighlight">\(s = \pm 1\)</span> ssytems which are widely used for studying the nature of phase transitions.</p></li>
<li><p>Many aspects of phase transitions are universal and independent of mciroscopic details of interactions. Hence One wants as simple of a model capable of displaying phase transition as possible! Ising models fit the bill perfectly and one could even obtain analytical solutions (1D and 2D).</p></li>
<li><p>Ising Models are defined by hamiltonian which encodes interactions between spins <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span> (nearest enighbours <span class="math notranslate nohighlight">\(|i-j|=1\)</span>) and interactions of spins with an external field <span class="math notranslate nohighlight">\(B\)</span></p></li>
</ul>
<div class="math notranslate nohighlight">
\[\boxed{H([s])= \sum_{\langle ij \rangle} J_{ij}s_i s_j - \mu B \sum_i s_i}\]</div>
<ul class="simple">
<li><p>Partition function is sum over all posisble microstates or in the case of Ising models over all possible spin configurations!</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\boxed{Z=\sum_{[s]}e^{-H([s])/k_B T}}\]</div>
<ul class="simple">
<li><p>Note that the spin lattice in Ising models could be in 1D, 2D, 3D, … ND dimensions. In this notebook we only look at 2D becuase it is the simplest system that can display phase-transition and plus is faster to simulate and visualize</p></li>
</ul>
<div class="section" id="thermodynamics-of-ising-models">
<h2>Thermodynamics of Ising models<a class="headerlink" href="#thermodynamics-of-ising-models" title="Permalink to this headline">¶</a></h2>
<div class="section" id="magnetization">
<h3>Magnetization<a class="headerlink" href="#magnetization" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><strong>Total magnetization, <span class="math notranslate nohighlight">\(M\)</span></strong></p></li>
</ul>
<div class="math notranslate nohighlight">
\[M([s])=\sum_is_i \]</div>
<ul class="simple">
<li><p><strong>Magnetization per spin <span class="math notranslate nohighlight">\(m\)</span></strong></p></li>
</ul>
<div class="math notranslate nohighlight">
\[m([s])=\frac{1}{N}\sum_is_i =\frac{M}{N}\]</div>
</div>
<div class="section" id="heat-capacity-c-v">
<h3>Heat capacity <span class="math notranslate nohighlight">\(C_v\)</span><a class="headerlink" href="#heat-capacity-c-v" title="Permalink to this headline">¶</a></h3>
<div class="math notranslate nohighlight">
\[ C_V(T) = \Big (\frac{\partial E}{\partial T} \Big )_V= \frac{1}{k_B T^2} \big(\langle E^2 \rangle-\langle E \rangle^2 \big) \]</div>
</div>
<div class="section" id="susceptibility-chi">
<h3>Susceptibility <span class="math notranslate nohighlight">\(\chi\)</span><a class="headerlink" href="#susceptibility-chi" title="Permalink to this headline">¶</a></h3>
<div class="math notranslate nohighlight">
\[\chi_T=\Big (\frac{\partial M}{\partial B} \Big )_T= \frac{1}{k_B T} \big(\langle M^2 \rangle-\langle M \rangle^2 \big) \]</div>
</div>
</div>
<div class="section" id="free-energy-profile">
<h2>Free energy profile<a class="headerlink" href="#free-energy-profile" title="Permalink to this headline">¶</a></h2>
<div class="math notranslate nohighlight">
\[Z(M) = \sum_{[s]} e^{-\beta H([s])} \delta (M-M([s]))\]</div>
<div class="math notranslate nohighlight">
\[F(M)=-\beta^{-1} log Z(M)\]</div>
<p>Note that <span class="math notranslate nohighlight">\(Z(M)\)</span> is a partial sum over states for which magnetization is equal to a particular value <span class="math notranslate nohighlight">\(M\)</span> as opposed to the full partition function <span class="math notranslate nohighlight">\(Z\)</span> where summation is unrestricted.</p>
</div>
<div class="section" id="numerical-calculation-of-thermodynamic-quantities">
<h2>Numerical calculation of thermodynamic quantities<a class="headerlink" href="#numerical-calculation-of-thermodynamic-quantities" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spins</span> <span class="o">=</span> <span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">spins</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">spins</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[-1  1  1  1 -1 -1  1 -1]
 [-1  1 -1 -1  1 -1 -1  1]
 [-1  1 -1 -1 -1  1 -1 -1]
 [-1 -1  1  1 -1  1 -1 -1]
 [-1  1 -1  1 -1 -1  1 -1]
 [-1 -1 -1 -1  1  1  1  1]
 [-1 -1 -1 -1  1 -1  1  1]
 [ 1 -1 -1 -1  1  1 -1  1]]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7fbd2b2c7050&gt;
</pre></div>
</div>
<img alt="../_images/01_MCMC_7_2.png" src="../_images/01_MCMC_7_2.png" />
</div>
</div>
</div>
<div class="section" id="enforcing-periodic-boundary-conditions">
<h2>Enforcing periodic boundary conditions<a class="headerlink" href="#enforcing-periodic-boundary-conditions" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">,</span><span class="mi">3</span><span class="p">],</span> 
              <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
              <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]])</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7fbd28bcad50&gt;
</pre></div>
</div>
<img alt="../_images/01_MCMC_9_1.png" src="../_images/01_MCMC_9_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_E</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Compute energy of spin lattice by lopping over each spin </span>
<span class="sd">    with periodic boundary conditions enforced </span>
<span class="sd">    via numpy roll&#39;&#39;&#39;</span> 
      
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> \
        <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="o">-</span><span class="n">J</span><span class="o">*</span><span class="n">spins</span><span class="o">*</span><span class="n">z</span><span class="o">/</span><span class="mi">4</span> <span class="p">)</span>
    
    <span class="k">return</span> <span class="n">E</span> <span class="o">-</span> <span class="n">B</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">spins</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_E2</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">B</span><span class="p">):</span>   
     
    <span class="n">N</span> <span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">spins</span><span class="p">)</span>
    <span class="n">E</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>   
            <span class="n">z</span> <span class="o">=</span> <span class="n">spins</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="k">N</span>, j] + spins[(i-1)%N, j] +\
                <span class="n">spins</span><span class="p">[</span><span class="n">i</span><span class="p">,(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="k">N</span>]  +  spins[i,(j-1)%N]
            <span class="n">E</span> <span class="o">+=</span> <span class="o">-</span><span class="n">J</span><span class="o">*</span><span class="n">z</span><span class="o">*</span><span class="n">spins</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="mi">4</span> 
            
    <span class="k">return</span> <span class="n">E</span> <span class="o">-</span> <span class="n">B</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">spins</span><span class="p">)</span> 


<span class="k">def</span> <span class="nf">get_dE</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Compute change in energy of 2D spin lattice </span>
<span class="sd">    after flipping a spin at a location (i,j&#39;&#39;&#39;</span> 
    
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spins</span><span class="p">)</span>
    
    <span class="n">z</span>  <span class="o">=</span> <span class="n">spins</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="k">N</span>, j] + spins[(i-1)%N, j] + \
             <span class="n">spins</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="k">N</span>] + spins[i, (j-1)%N] 
             
    <span class="n">dE</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">spins</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">J</span><span class="o">*</span><span class="n">z</span> <span class="o">+</span> <span class="n">B</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">dE</span>
        
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#get_E(spins)</span>
<span class="c1">#get_dE(spins, 1, 2)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="sampling-of-boltzmann-distribution-mc-vs-mcmc">
<h2>Sampling of Boltzmann distribution: MC vs MCMC<a class="headerlink" href="#sampling-of-boltzmann-distribution-mc-vs-mcmc" title="Permalink to this headline">¶</a></h2>
<p><strong>MC sampling</strong></p>
<ul class="simple">
<li><p>How to compute the expectation value of a thermodynamic variable <span class="math notranslate nohighlight">\(A\)</span>. In theory everything is simple: we need to sample from the exponential distribution.</p></li>
</ul>
<div class="math notranslate nohighlight">
\[P(E_i)= \frac{e^{-\beta E_i}}{\sum_i e^{-\beta E_i}}\]</div>
<div class="math notranslate nohighlight">
\[\langle A\rangle = \sum_i A_iP(E_i) \approx\frac{1}{N}\sum_{i=1}^N \underbrace{A_i}_{{\rm chosen}\ {\rm acc.}\ {\rm to}\ P(E_i)}\]</div>
<ul class="simple">
<li><p>In practice the brute force MC sampling of exponential fails for even smallest ising lattices.</p></li>
</ul>
<p><strong>Problems with MC</strong></p>
<ul class="simple">
<li><p>There is an astronomical number of states, <span class="math notranslate nohighlight">\(i = 1... N^2\)</span>!</p></li>
<li><p>Most of these microstates make exponentially small contribution to probability distribution! <span class="math notranslate nohighlight">\(P(E_i)\)</span></p></li>
<li><p>Brute force MC will not be efficient for sampling important portions of <span class="math notranslate nohighlight">\(P(E_i)\)</span>.</p></li>
<li><p><strong>Conclusion: We need Importance sampling!</strong></p></li>
</ul>
<p><strong>MCMC Sampling</strong></p>
<ul class="simple">
<li><p>Instead of ranodmly picking states we generate chain of states. This sampling technique is known as Markov Chain Monte Carlo (MCMC). MCMC generates random walks in configuration space and is more efficient at finding sampling states than basic MC.</p></li>
</ul>
</div>
<div class="section" id="generating-chains-master-equation-and-detailed-balance">
<h2>Generating chains! Master Equation and Detailed Balance<a class="headerlink" href="#generating-chains-master-equation-and-detailed-balance" title="Permalink to this headline">¶</a></h2>
<p><strong>Random chain</strong></p>
<ul class="simple">
<li><p>In simple MC each sampled state <span class="math notranslate nohighlight">\(X_i\)</span> at steo <span class="math notranslate nohighlight">\(i\)</span> is independet of the next or previous steps.</p></li>
<li><p>Thus, MC sampling generates totally uncorrelated samples which is good for rapid convergence according to Central Limit Theorem. But as we remarked above the samples are most likely not covering important areas!</p></li>
</ul>
<div class="math notranslate nohighlight">
\[P(X_N, ..., X_2, X_1) = P_N(X_N)\cdot ... P_2(X_2) \cdot P_1(X_1)\]</div>
<p><strong>Markov chain:</strong></p>
<ul class="simple">
<li><p>In simple MCMC each sampled state <span class="math notranslate nohighlight">\(X_i\)</span> at steo <span class="math notranslate nohighlight">\(i\)</span> is generated from <span class="math notranslate nohighlight">\(i-1\)</span>.</p></li>
<li><p>This introduces correlations between samples which means slower covnergence to the mean.</p></li>
<li><p>On the other hand MCMC find the important areas for sampling much faster so in the hand it wins big compared to MC.</p></li>
</ul>
<div class="math notranslate nohighlight">
\[P(X_N, ..., X_2, X_1) = P_N(X_N)\cdot ... P_3(X_3| X_2) \cdot P_2(X_2| X_1)... P_1(X_1)\]</div>
<ul class="simple">
<li><p>The probability of picking state <span class="math notranslate nohighlight">\(i+1\)</span> given taht we started from <span class="math notranslate nohighlight">\(i\)</span> is referred to as <strong>transition probability</strong> <span class="math notranslate nohighlight">\(T_{ij}\)</span></p></li>
</ul>
<div class="math notranslate nohighlight">
\[T(X_2 \leftarrow X_1) = T_{21} = P(X_2|X_1)\]</div>
<ul class="simple">
<li><p>As any probability it should be normalized meaning summing over all possible states should yield one:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\sum_{X} T(X\leftarrow X') = 1\]</div>
<p><strong>Probability of being at <span class="math notranslate nohighlight">\(X\)</span> at <span class="math notranslate nohighlight">\(t+\Delta t\)</span> given a prior state at <span class="math notranslate nohighlight">\((X',t)\)</span></strong></p>
<div class="math notranslate nohighlight">
\[P(X, t+\Delta t) = \sum_{X'}  T(X \leftarrow X') P(X', t)\]</div>
<ul class="simple">
<li><p>Subtracting P(X,t) from both states we can obtain equation of motion for Markov chain.</p></li>
</ul>
<div class="math notranslate nohighlight">
\[P(X, t+\Delta t) -P(X,t)= \sum_{X'}  T(X \leftarrow X') P(X', t) - P(X, t)\sum_{X'} T(X'\leftarrow X)\]</div>
<p><strong>Master equation: A continuity equation in probability space.</strong></p>
<div class="math notranslate nohighlight">
\[\boxed{\frac{\partial P(X,t)}{\partial t} = \sum_{X'}  w_{X X'} P(X', t) - \sum_{X'} w_{X' X} P(X, t)}\]</div>
<ul class="simple">
<li><p>Where we have defined transition rates as: <span class="math notranslate nohighlight">\(w(X' \rightarrow X, t) = lim_{\Delta t \rightarrow 0}\frac{T(X' \rightarrow X, t)}{\Delta t}\)</span></p></li>
</ul>
</div>
<div class="section" id="detailed-balance-equilibrium">
<h2>Detailed Balance = Equilibrium<a class="headerlink" href="#detailed-balance-equilibrium" title="Permalink to this headline">¶</a></h2>
<br>
<div class="math notranslate nohighlight">
\[\boxed{\frac{\partial P(X,t)}{\partial t}  = \sum_{X'} P(X', t) w_{X'X} - \sum_{X'} P(X, t) w_{X X'}}=0\]</div>
<br>
<div class="math notranslate nohighlight">
\[\boxed{ p_i w_{ij} = p_j w_{ji}  }\]</div>
<p><strong>Master equation for a two state dynamics</strong></p>
<div class="math notranslate nohighlight">
\[\frac{dP(x_1,t)}{dt} = p_1 w_{12} - p_2 w_{21}\]</div>
<div class="math notranslate nohighlight">
\[\frac{dP(x_2,t)}{dt} = p_2 w_{21} - p_1 w_{12}\]</div>
<ul class="simple">
<li><p>In the equilibrium we see that equilibrium is established when probability ratio matches the ratio of tranistions <span class="math notranslate nohighlight">\(\frac{p_1}{p_2} = \frac{w_{21}}{w_{12}}\)</span></p></li>
<li><p>In the <span class="math notranslate nohighlight">\(NVT\)</span> ensemble we have an explicit requirment for transition rates <span class="math notranslate nohighlight">\(\frac{p_1}{p_2} = e^{-\beta (E_1-E_2)} = \frac{w_{21}}{w_{12}}\)</span></p></li>
</ul>
</div>
<div class="section" id="how-to-pick-the-moves-for-markov-chain">
<h2>How to pick the moves for Markov chain?<a class="headerlink" href="#how-to-pick-the-moves-for-markov-chain" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Now it is time to consider practical aspects of conducting MCMC. How to pick states and transitions?</p></li>
</ul>
<div class="math notranslate nohighlight">
\[[transition] =  [accept/reject] \cdot [move]\]</div>
<div class="math notranslate nohighlight">
\[T(X' \leftarrow X) = \alpha_{X' X}\cdot A_{X' X} \]</div>
<ul class="simple">
<li><p>We have great freedom in picking states and moves as long as we satisfy the detailed balance! E.g as long as the ratio of transition probabilities matches ration of Botlzman factors!</p></li>
</ul>
<ul class="simple">
<li><p>The simplest case for move is to pick one spins at random per iteration:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\alpha_{X' X} = \frac{1}{L^2}\]</div>
<ul class="simple">
<li><p>For transitions we adopt criteria that favors our chain to explore low energy (high probability) configurations:</p></li>
<li><p>If <span class="math notranslate nohighlight">\(p(X') &lt; p(X),\,\,\,\,\)</span> <span class="math notranslate nohighlight">\(A_{X'X}=\frac{p(X')}{p(X)}\)</span></p></li>
<li><p>If <span class="math notranslate nohighlight">\(p(X') \geq p(X),\,\,\,\)</span> <span class="math notranslate nohighlight">\(A_{X'X}=1\)</span></p></li>
</ul>
<div class="math notranslate nohighlight">
\[\frac{T_{X'X}}{T_{XX'}} = \frac{1/L^2}{1/L^2} \cdot \frac{p(X')/p(X)}{1}\]</div>
</div>
<div class="section" id="metropolis-algorithm">
<h2>Metropolis algorithm<a class="headerlink" href="#metropolis-algorithm" title="Permalink to this headline">¶</a></h2>
<p><span class="math notranslate nohighlight">\({\bf i. Initialization.}\)</span> Generate some initiaal configuration for spins <span class="math notranslate nohighlight">\([s_0]=(s_1,...s_N)\)</span>. For instnace Choosing random orientation for each spins <span class="math notranslate nohighlight">\((+1, -1)\)</span> or giving them  the same orientation.</p>
<p><span class="math notranslate nohighlight">\({\bf ii. Attempt\,\, spin\,\, flip.\,\,}\)</span> Pick a spin at random and flip it. E.g multiply by -1 so that +1 state becomes -1 and vice versa. this generated a new configuration <span class="math notranslate nohighlight">\([s_1]\)</span></p>
<p><span class="math notranslate nohighlight">\({\bf iii. Acceptance/Rejection}\)</span> Evaluate energy differene between old configuration <span class="math notranslate nohighlight">\([s_{0}]\)</span> and new one <span class="math notranslate nohighlight">\([s_{1}]\)</span> with flipped spin which has created in previous step. The <span class="math notranslate nohighlight">\(\Delta E=E_{1}-E_{0}\)</span> is used for deciding weather the move is accepted or rejected in a way that is consistent with Boltzman distribution:</p>
<div class="math notranslate nohighlight">
\[w=\frac{P[s_{1}]}{P[s_{0}]}=exp\big(-\beta[E_{1}-E_{0}] \big ) \]</div>
<p>This is done by generating a unifor random number <span class="math notranslate nohighlight">\(r\)</span> between <span class="math notranslate nohighlight">\([0,1]\)</span> and</p>
<p>(a) if <span class="math notranslate nohighlight">\(r  \leq w\)</span> Accept the spin flip thereby keeping <span class="math notranslate nohighlight">\([s_1]\)</span> and proceeding to try new spin flip via step ii.</p>
<p>(b) if <span class="math notranslate nohighlight">\(r  &gt; w\)</span> reject the spin flip and set  <span class="math notranslate nohighlight">\([s_1]=[s_0]\)</span> and proceeding to try a new spin flip via step ii.</p>
<div class="section" id="code-for-running-2d-ising-mcmc-simulations">
<h3>Code for running 2D ising MCMC Simulations<a class="headerlink" href="#code-for-running-2d-ising-mcmc-simulations" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>If numba is installed, uncomment to benfit from jit acceleration!</p></li>
<li><p>To speed benchmarks to assess how long simulation would take</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#from numba import jit</span>
<span class="c1">#@jit</span>
<span class="k">def</span> <span class="nf">run_ising2d</span><span class="p">(</span><span class="n">spins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)),</span> 
                <span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                <span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                <span class="n">B</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                <span class="n">n_steps</span><span class="o">=</span><span class="mi">20000</span><span class="p">,</span> 
                <span class="n">out_freq</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Basic Metropolis Monte Carlo simulator of 2D Ising model</span>
<span class="sd">    ---</span>
<span class="sd">    spins:    (int, int) 2D numpy array</span>
<span class="sd">    T, J, B:  (floats) corresponding to temperature, coupling and field variables</span>
<span class="sd">    n_steps:  (int), simulation steeps</span>
<span class="sd">    out_freq: (int), How often to compute and save data</span>
<span class="sd">    ---</span>
<span class="sd">    Returns:</span>
<span class="sd">    E/N: per-spin energy over n steps  </span>
<span class="sd">    M/N: per-spin magnetization over n steps </span>
<span class="sd">    S:   2D spin configurations over n steps </span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="c1">#### Initialize simulation</span>
    <span class="n">N</span>   <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spins</span><span class="p">)</span>
    <span class="n">M_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">spins</span><span class="p">)</span>
    <span class="n">E_t</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span> 
            <span class="n">z</span>    <span class="o">=</span> <span class="n">spins</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="k">N</span>, j] + spins[(i-1)%N, j] + spins[i,(j+1)%N] + spins[i,(j-1)%N]
            <span class="n">E_t</span> <span class="o">+=</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span> <span class="o">*</span> <span class="n">J</span> <span class="o">*</span> <span class="n">z</span>

    <span class="c1">#### Run MC Simulation</span>
    <span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">M</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_steps</span><span class="p">):</span>
        
        <span class="c1"># Pick random spin</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

        <span class="c1"># Compute energy change resulting from a flip of spin at i,j</span>
        <span class="n">z</span>  <span class="o">=</span> <span class="n">spins</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="k">N</span>, j] + spins[(i-1)%N, j] + spins[i, (j+1)%N] + spins[i, (j-1)%N] 
        <span class="n">dE</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">spins</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">J</span><span class="o">*</span><span class="n">z</span> <span class="o">+</span> <span class="n">B</span><span class="p">)</span>

        <span class="c1"># Metropolis condition</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dE</span><span class="o">/</span><span class="n">T</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">():</span>
            <span class="n">spins</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span> 
            <span class="n">E_t</span>        <span class="o">+=</span> <span class="n">dE</span>
            <span class="n">M_t</span>        <span class="o">+=</span> <span class="mi">2</span><span class="o">*</span><span class="n">spins</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>

        <span class="c1"># Save Thermo data</span>
        <span class="k">if</span> <span class="n">step</span> <span class="o">%</span> <span class="n">out_freq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">M</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">M_t</span><span class="p">)</span>
            <span class="n">E</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_t</span><span class="p">)</span>
            <span class="n">S</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spins</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">S</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="o">/</span><span class="n">N</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">/</span><span class="n">N</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>it
<span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">M</span> <span class="o">=</span> <span class="n">run_ising2d</span><span class="p">(</span><span class="n">spins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">)),</span> 
                <span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                <span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                <span class="n">B</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                <span class="n">n_steps</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> 
                <span class="n">out_freq</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.07 s ± 8.98 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@widgets</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10000</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">plot_image</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>  <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;$i$&#39;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;j&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;$E$&#39;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;steps&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;$M$&#39;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;steps&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"version_major": 2, "version_minor": 0, "model_id": "4e8d3ce6220447a9bcbaff65a724ca8f"}
</script><img alt="../_images/01_MCMC_27_1.png" src="../_images/01_MCMC_27_1.png" />
</div>
</div>
</div>
<div class="section" id="carry-out-explorative-simulations">
<h3>Carry out explorative simulations<a class="headerlink" href="#carry-out-explorative-simulations" title="Permalink to this headline">¶</a></h3>
<p><span class="math notranslate nohighlight">\(\bf{i.}\)</span> Test the dependence of observables on system size.</p>
<p><span class="math notranslate nohighlight">\(\bf{ii.}\)</span> Test the dependence of observables on initital conditions.</p>
<p><span class="math notranslate nohighlight">\(\bf{iii.}\)</span> Vary intensive parameters, e.g temperature and field strength. Investigate changes in observables such as magnetization, energy, susceptibility, heat capacity.</p>
<p><span class="math notranslate nohighlight">\(\bf{iv.}\)</span> How do we know if simulation has done enough sampling? How do we assess covnergence and errors?</p>
<p><span class="math notranslate nohighlight">\(\bf{v.}\)</span> Think about alternative ways of accelerating and enhancing the sampling.</p>
<div class="section" id="parameter-sweeps-and-calculation-of-second-order-thermodynamic-quantities">
<h4>Parameter sweeps and calculation of second order thermodynamic quantities<a class="headerlink" href="#parameter-sweeps-and-calculation-of-second-order-thermodynamic-quantities" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_Cv</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="o">/</span><span class="n">T</span><span class="o">**</span><span class="mi">2</span>

<span class="k">def</span> <span class="nf">get_Xi</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">/</span><span class="n">T</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Carry out multiple MC runs at differnet Temperatures. </span>
<span class="c1"># This calculation may take ~5 mins. </span>
<span class="c1"># Think about equilibration, convergence and statistical errors</span>

<span class="n">Ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span> 
<span class="n">n_equil</span>  <span class="o">=</span> <span class="mi">100000</span>
<span class="n">out</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">Es</span><span class="p">,</span> <span class="n">Ms</span><span class="p">,</span> <span class="n">Cs</span><span class="p">,</span> <span class="n">Xs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>  

<span class="k">for</span> <span class="n">T</span> <span class="ow">in</span> <span class="n">Ts</span><span class="p">:</span>
    
    <span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">M</span> <span class="o">=</span> <span class="n">run_ising2d</span><span class="p">(</span><span class="n">spins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">)),</span> 
                          <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> 
                          <span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                          <span class="n">B</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                          <span class="n">n_steps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n_equil</span><span class="p">),</span> 
                          <span class="n">out_freq</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
    
    <span class="n">E</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">n_equil</span><span class="o">//</span><span class="n">out</span><span class="p">:]</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">n_equil</span><span class="o">//</span><span class="n">out</span><span class="p">:]</span>
    
    <span class="n">Es</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">E</span><span class="p">))</span>
    <span class="n">Ms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">M</span><span class="p">))</span>
    
    <span class="n">Cs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_Cv</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span> 
    <span class="n">Xs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_Xi</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ipykernel_2601</span><span class="o">/</span><span class="mf">827518612.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span>                           <span class="n">B</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span>                           <span class="n">n_steps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n_equil</span><span class="p">),</span>
<span class="ne">---&gt; </span><span class="mi">18</span>                           <span class="n">out_freq</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span> 
<span class="g g-Whitespace">     </span><span class="mi">20</span>     <span class="n">E</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">n_equil</span><span class="o">//</span><span class="n">out</span><span class="p">:]</span>

<span class="nn">/tmp/ipykernel_2601/679771127.py</span> in <span class="ni">run_ising2d</span><span class="nt">(spins, T, J, B, n_steps, out_freq)</span>
<span class="g g-Whitespace">     </span><span class="mi">34</span> 
<span class="g g-Whitespace">     </span><span class="mi">35</span>         <span class="c1"># Pick random spin</span>
<span class="ne">---&gt; </span><span class="mi">36</span>         <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">37</span> 
<span class="g g-Whitespace">     </span><span class="mi">38</span>         <span class="c1"># Compute energy change resulting from a flip of spin at i,j</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>  <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Ts</span><span class="p">,</span> <span class="n">Es</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;$E(T)$&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Ts</span><span class="p">,</span> <span class="n">Ms</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;$M(T)$&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Ts</span><span class="p">,</span> <span class="n">Cs</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;$C_v(T)$&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Ts</span><span class="p">,</span> <span class="n">Xs</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;$\Xi(T)$&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/01_MCMC_32_0.png" src="../_images/01_MCMC_32_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="problems">
<h3>Problems<a class="headerlink" href="#problems" title="Permalink to this headline">¶</a></h3>
<div class="section" id="problem-1">
<h4>Problem-1<a class="headerlink" href="#problem-1" title="Permalink to this headline">¶</a></h4>
<p>Revisit the example MCMC simulation for determining <span class="math notranslate nohighlight">\(\pi\)</span> value. Vary the size of the displacement to determine the optimal size that generates quickest convergence to the value of <span class="math notranslate nohighlight">\(\pi\)</span></p>
</div>
<div class="section" id="problem-2">
<h4>Problem-2<a class="headerlink" href="#problem-2" title="Permalink to this headline">¶</a></h4>
<p>Carry out MC simulation of 2D ising spin model for various lattice sizes <span class="math notranslate nohighlight">\(N= 16,32, 64\)</span> at temperatures above and below critical e.g <span class="math notranslate nohighlight">\(T&lt;T_c\)</span> and <span class="math notranslate nohighlight">\(T&gt;T_c\)</span>.</p>
<ul class="simple">
<li><p>How long does it take to equilibrate system as a function of size and as a function of T?</p></li>
<li><p>Plot some observables as a function of number of samples states to show that the system is carrying out some sort of random walk in the configurational space.</p></li>
<li><p>How do profiles of Energy vs T, Magnetization vs T and heat capacity vs T, and susceptibility vs T change as a function of size of our lattice.</p></li>
<li><p>Does <span class="math notranslate nohighlight">\(J&gt;0\)</span> and <span class="math notranslate nohighlight">\(J&lt;0\)</span> change the nature of phase transition?</p></li>
</ul>
</div>
<div class="section" id="problem-3">
<h4>Problem-3<a class="headerlink" href="#problem-3" title="Permalink to this headline">¶</a></h4>
<p>Compute correlation functions of spin variable, that is how correlated are spins as a function of distance on a lattice, <span class="math notranslate nohighlight">\(L\)</span>. <span class="math notranslate nohighlight">\(C(L)=\langle s_i s_{i+L}\rangle -\langle s_i\rangle \langle s_{i+L}\rangle \)</span> Make sure to account for the periodic boundary conditions!</p>
<blockquote>
<div><p>Note that you can pick a special tagged spin and calculate correlation function of taged spin (<span class="math notranslate nohighlight">\(s_13\)</span> for instance) with any other as a function of lattice spearation  by averaging over produced MC configurations.  Or you can take advantage of the fact that there are no priviledged spins and average over many spins and average over MC configruations e.g <span class="math notranslate nohighlight">\(s_1, s_2, ...\)</span>. E.g you can pick a horizontal line of spins and run a summation for each fixed r_ab distance.</p>
</div></blockquote>
</div>
<div class="section" id="problem-4">
<h4>Problem-4<a class="headerlink" href="#problem-4" title="Permalink to this headline">¶</a></h4>
<p>Take a 20 by 20 lattice and equilibriate the system with a value of extneral field B equal to +1.
Now slowly change h to −1 in discrete steps during each of these steps, use the previously equilibriated
configuration as an input to the system to undergo equilibriation again.</p>
<p>Caluclate average and variance quantities (e.g E, M, C etc). Notice anything interesing :)</p>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "DPotoyan/Statmech4ChemBio",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./6_ising"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="intro.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Phase transitions</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="02_ising_analytic.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Phase transitions through the lense of Ising models</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Davit Potoyan<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>