
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ising models and Metropolis-Hastings algorithm &#8212; Statistical Mechanics for Chemistry and Biology</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Phase transitions through the lense of Ising models" href="02_ising_analytic.html" />
    <link rel="prev" title="Phase transitions and Ising models" href="intro.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.jpg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Statistical Mechanics for Chemistry and Biology</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   Statistical Mechanics for Chemistry and Biology
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../0_python/intro.html">
   python
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../0_python/intro2py.html">
     Why Python?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../0_python/intro2numpy.html">
     NumPy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../0_python/intro2viz.html">
     Plotting
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../1_stats/intro.html">
   Stats
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_stats/01_SetsCounting.html">
     Probability by counting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_stats/02_RandVar.html">
     Random variable, stochastic process and simulation.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_stats/03_MC.html">
     “Monte Carlo and the power of randomness”
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_stats/04_LimitTheorems.html">
     Appendix B1: Probability distirbutions functions (PDFs) and Limit theorems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_stats/05_InverseTransform.html">
     Appendix B2: The Inverse Transform of RVs
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../2_thermo/intro.html">
   Thermodynamics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_thermo/01_Thermo.html">
     Review of thermodynamics principles
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Chapters
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../3_ensembles/intro.html">
   Statistical ensembles
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../3_ensembles/nve.html">
     NVE
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../3_ensembles/phase_space.html">
     NVE
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../3_ensembles/nvt.html">
     NVT
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../3_ensembles/npt.html">
     NPT
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../3_ensembles/applications.html">
     Applications
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../4_ideal_systems/intro.html">
   Ideal Systems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../4_ideal_systems/classical_systems.html">
     Classical gases
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../4_ideal_systems/quantum_systems.html">
     Quantum non-interacting systems
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../5_entropy/intro.html">
   Entropy and Information
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="simple">
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="intro.html">
   Phase transitions and Ising models
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Ising models and Metropolis-Hastings algorithm
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02_ising_analytic.html">
     Phase transitions through the lense of Ising models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_MeanField.html">
     Mean Field Theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04_EnhanceSampl.html">
     Non-boltzman (enhanced) sampling ideas
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../7_fluids/intro.html">
   Fluids and introduction to Molecular Dynamics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="simple">
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/6_ising/01_MCMC.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/DPotoyan/Statmech4ChemBio/master?urlpath=lab/tree/6_ising/01_MCMC.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/DPotoyan/Statmech4ChemBio/blob/master/6_ising/01_MCMC.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#estimate-pi-via-mcmc">
   Estimate
   <span class="math notranslate nohighlight">
    \(\pi\)
   </span>
   via MCMC
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ising-models-the-h-atom-of-phase-transitions">
   Ising models: The H atom of phase transitions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#enforcing-periodic-boundary-conditions">
     Enforcing periodic boundary conditions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#computing-thermodynamic-quantities">
     Computing Thermodynamic quantities
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#energy-e">
       Energy
       <span class="math notranslate nohighlight">
        \(E\)
       </span>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#magnetization">
       Magnetization
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#heat-capacity-c-v">
       Heat capacity
       <span class="math notranslate nohighlight">
        \(C_v\)
       </span>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#susceptibility-chi">
       Susceptibility
       <span class="math notranslate nohighlight">
        \(\chi\)
       </span>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#correlation-function-c-i-j-and-correlation-length">
       Correlation function
       <span class="math notranslate nohighlight">
        \(c(i,j)\)
       </span>
       and correlation length
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#parition-function-and-free-energy">
       Parition function and Free energy
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sampliing-of-boltzmann-distribution-nvt-mc-vs-mcmc">
     Sampliing of Boltzmann distribution (NVT). MC vs MCMC
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#master-equation-and-detailed-balance">
     Master Equation and Detailed Balance
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#detailed-balance-equilibrium">
     Detailed Balance = Equilibrium
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-to-pick-the-moves-for-markov-chain">
     How to pick the moves for Markov chain?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#metropolis-algorithm">
   Metropolis algorithm
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#carry-out-explorative-simulations">
     Carry out explorative simulations
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#parameter-sweeps-run-mc-simulatons-of-2d-ising-model-at-different-ts">
       Parameter sweeps: run MC simulatons  of 2D Ising model at different  Ts
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#problems">
     Problems
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#problem-1">
     Problem-1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#problem-2">
     Problem-2
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#problem-3">
     Problem-3
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#problem-4">
     Problem-4
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="ising-models-and-metropolis-hastings-algorithm">
<h1>Ising models and Metropolis-Hastings algorithm<a class="headerlink" href="#ising-models-and-metropolis-hastings-algorithm" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>

<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">rand</span><span class="p">,</span> <span class="n">random</span><span class="p">,</span> <span class="n">randint</span><span class="p">,</span> <span class="n">choice</span><span class="p">,</span> <span class="n">normal</span><span class="p">,</span> <span class="n">uniform</span> 
</pre></div>
</div>
</div>
</div>
<div class="section" id="estimate-pi-via-mcmc">
<h2>Estimate <span class="math notranslate nohighlight">\(\pi\)</span> via MCMC<a class="headerlink" href="#estimate-pi-via-mcmc" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mcmc_pi</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Using MCMC algorithm to estimate the value of pi&#39;&#39;&#39;</span>
    
    <span class="n">pts</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># array for points in square</span>
    
    <span class="n">r_old</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># 2 points within [0, 1] for x and y</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        
        <span class="n">dr</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="n">r_new</span> <span class="o">=</span> <span class="n">r_old</span> <span class="o">+</span> <span class="n">dr</span>
        
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">r_new</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">1.0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">r_new</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">:</span>
            
            <span class="n">pts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_new</span><span class="p">)</span>
            
            <span class="n">r_old</span> <span class="o">=</span> <span class="n">r_new</span>
    
    <span class="n">pts</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
    <span class="n">hits</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="mi">4</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">hits</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pi_value</span> <span class="o">=</span>  <span class="n">mcmc_pi</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Estimated Pi value is: &quot;</span><span class="p">,</span> <span class="n">pi_value</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Estimated Pi value is:  3.4426608358665316
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_runs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1001</span><span class="p">)</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1">#Estimate pi via a number of mcmc simulations</span>
<span class="n">pi_vals</span>      <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mcmc_pi</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">n_runs</span><span class="p">]</span> <span class="p">)</span>
 
<span class="c1"># Calculaate how mean improves with number of runs</span>
<span class="n">sample_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pi_vals</span> <span class="p">)</span><span class="o">/</span><span class="n">n_runs</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_runs</span><span class="p">,</span> <span class="n">sample_mean</span><span class="p">,</span> <span class="s1">&#39;-s&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$N$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$S_N/N$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span> <span class="sa">f</span><span class="s2">&quot;Mean: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pi_vals</span> <span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, Var: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">pi_vals</span> <span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Mean: 3.4306, Var: 0.1968&#39;)
</pre></div>
</div>
<img alt="../_images/01_MCMC_5_1.png" src="../_images/01_MCMC_5_1.png" />
</div>
</div>
</div>
<div class="section" id="ising-models-the-h-atom-of-phase-transitions">
<h2>Ising models: The H atom of phase transitions<a class="headerlink" href="#ising-models-the-h-atom-of-phase-transitions" title="Permalink to this headline">¶</a></h2>
<div class="math notranslate nohighlight">
\[\boxed{H([s])= \sum_{\langle ij \rangle} J_{ij}s_i s_j - \mu B \sum_i s_i}\]</div>
<br>
<div class="math notranslate nohighlight">
\[\boxed{Z=\sum_{[s]}e^{-H([s])/k_B T}}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lattice</span> <span class="o">=</span> <span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">lattice</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">lattice</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[ 1  1  1  1 -1 -1  1  1]
 [-1 -1  1 -1 -1 -1  1  1]
 [-1  1  1  1 -1 -1 -1  1]
 [-1 -1  1 -1 -1 -1 -1 -1]
 [-1 -1 -1 -1  1 -1 -1  1]
 [-1 -1  1  1  1  1 -1 -1]
 [ 1 -1 -1  1 -1 -1  1  1]
 [ 1 -1  1  1 -1 -1 -1 -1]]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7fade1883710&gt;
</pre></div>
</div>
<img alt="../_images/01_MCMC_7_2.png" src="../_images/01_MCMC_7_2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lattice</span><span class="p">[:,:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 1,  1,  1,  1, -1, -1,  1,  1],
       [-1, -1,  1, -1, -1, -1,  1,  1],
       [-1,  1,  1,  1, -1, -1, -1,  1],
       [-1, -1,  1, -1, -1, -1, -1, -1],
       [-1, -1, -1, -1,  1, -1, -1,  1],
       [-1, -1,  1,  1,  1,  1, -1, -1],
       [ 1, -1, -1,  1, -1, -1,  1,  1],
       [ 1, -1,  1,  1, -1, -1, -1, -1]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">E</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        
        <span class="n">E</span> <span class="o">+=</span> <span class="n">lattice</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span> <span class="n">lattice</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">lattice</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">lattice</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">lattice</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>38
</pre></div>
</div>
</div>
</div>
<div class="section" id="enforcing-periodic-boundary-conditions">
<h3>Enforcing periodic boundary conditions<a class="headerlink" href="#enforcing-periodic-boundary-conditions" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><strong>Method-1: Creating roll over indes using modulo operator %</strong></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span><span class="o">%</span><span class="k">8</span>, 1%8, 2%8, 3%8, 8%8
<span class="c1">#lattice[8%8,5]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0, 1, 2, 3, 0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">8</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="n">lattice</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="k">N</span> , 3])
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-1
1
-1
-1
1
1
1
1
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">E</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        
        <span class="n">E</span> <span class="o">+=</span> <span class="n">lattice</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span> <span class="n">lattice</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="k">N</span> , j] + lattice[i,j-1] + lattice[i+1,j] + lattice[i-1,j])

<span class="nb">print</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>36
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><strong>Method-2: Creating roll over indes using numpy roll function</strong></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 1, -1,  1,  1, -1, -1, -1, -1],
       [ 1,  1,  1,  1, -1, -1,  1,  1],
       [-1, -1,  1, -1, -1, -1,  1,  1],
       [-1,  1,  1,  1, -1, -1, -1,  1],
       [-1, -1,  1, -1, -1, -1, -1, -1],
       [-1, -1, -1, -1,  1, -1, -1,  1],
       [-1, -1,  1,  1,  1,  1, -1, -1],
       [ 1, -1, -1,  1, -1, -1,  1,  1]])
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="computing-thermodynamic-quantities">
<h3>Computing Thermodynamic quantities<a class="headerlink" href="#computing-thermodynamic-quantities" title="Permalink to this headline">¶</a></h3>
<div class="section" id="energy-e">
<h4>Energy <span class="math notranslate nohighlight">\(E\)</span><a class="headerlink" href="#energy-e" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p><strong>Energy of a configuration</strong></p></li>
</ul>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}E[s] = H([s])= \sum_{\langle ij \rangle} J_{ij}s_i s_j - \mu B \sum_i s_i$$. \\
- **Ensemble average Energy**\\$$ \langle E \rangle \approx \frac{1}{n_{MC}} \sum^{i=n_{MC}}_{i=1} H[s_i] \end{aligned}\end{align} \]</div>
</div>
<div class="section" id="magnetization">
<h4>Magnetization<a class="headerlink" href="#magnetization" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p><strong>Total magnetization, <span class="math notranslate nohighlight">\(M\)</span></strong></p></li>
</ul>
<div class="math notranslate nohighlight">
\[M([s])=\sum_is_i \]</div>
<ul class="simple">
<li><p><strong>Magnetization per spin <span class="math notranslate nohighlight">\(m\)</span></strong></p></li>
</ul>
<div class="math notranslate nohighlight">
\[m([s])=\frac{1}{N}\sum_is_i =\frac{M}{N}\]</div>
<ul class="simple">
<li><p><strong>Ensemble averaged Magnetization</strong></p></li>
</ul>
<div class="math notranslate nohighlight">
\[\langle M \rangle  \approx \frac{1}{n_{MC}} \sum^{i=n_{MC}}_{i=1} M[s_i]\]</div>
</div>
<div class="section" id="heat-capacity-c-v">
<h4>Heat capacity <span class="math notranslate nohighlight">\(C_v\)</span><a class="headerlink" href="#heat-capacity-c-v" title="Permalink to this headline">¶</a></h4>
<p>Heat capacity is again the familiar expression established in our treatment of canonical ensemble.</p>
<div class="math notranslate nohighlight">
\[ C_V(T) = \Big (\frac{\partial E}{\partial T} \Big )_V= \frac{1}{k_B T^2} \big(\langle E^2 \rangle-\langle E \rangle^2 \big) \]</div>
</div>
<div class="section" id="susceptibility-chi">
<h4>Susceptibility <span class="math notranslate nohighlight">\(\chi\)</span><a class="headerlink" href="#susceptibility-chi" title="Permalink to this headline">¶</a></h4>
<p>Magnetic susceptibility quantifies response of the ssytem to the variation of magnetic field.</p>
<div class="math notranslate nohighlight">
\[\chi_T=\Big (\frac{\partial M}{\partial B} \Big )_T= \frac{1}{k_B T} \big(\langle M^2 \rangle-\langle M \rangle^2 \big) \]</div>
</div>
<div class="section" id="correlation-function-c-i-j-and-correlation-length">
<h4>Correlation function <span class="math notranslate nohighlight">\(c(i,j)\)</span>  and correlation length<a class="headerlink" href="#correlation-function-c-i-j-and-correlation-length" title="Permalink to this headline">¶</a></h4>
<p>At high temperatures, spins on an ising lattice point up and down randomly. While at low temperatures, all spins tend to align. To quantify the degree of alignment, we can define a quantity named correlation length <span class="math notranslate nohighlight">\(\xi\)</span>, which can be defined mathematically through correlation function <span class="math notranslate nohighlight">\(c(i,j)\)</span></p>
<div class="math notranslate nohighlight">
\[c(i,j)=\langle s_i-\langle s_i\rangle\rangle \langle s_j-\langle s_j\rangle\rangle\]</div>
</div>
<div class="section" id="parition-function-and-free-energy">
<h4>Parition function and Free energy<a class="headerlink" href="#parition-function-and-free-energy" title="Permalink to this headline">¶</a></h4>
<div class="math notranslate nohighlight">
\[Z=\sum_{[s]}e^{-\beta H([s])}=\sum_{[s]}e^{-\beta \big ( \sum_{\langle ij \rangle} J_{ij}s_i s_j - \mu B M \big )}\]</div>
<p><br><br></p>
<div class="math notranslate nohighlight">
\[F=-\beta^{-1} log Z \]</div>
<ul class="simple">
<li><p><strong>Free energy as a function of M (Potential of mean force)</strong></p></li>
</ul>
<br>
<div class="math notranslate nohighlight">
\[Z(M) = \sum_{[s]} e^{-\beta H([s])} \delta (M-M([s]))\]</div>
<div class="math notranslate nohighlight">
\[F(M)=-\beta^{-1} log Z(M)\]</div>
<p>The  Z(M) is a partial sum over states for which magnetization is equal to a particular value M as opposed to Z where summation is unrestricted.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getE</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">B</span><span class="p">):</span>    
    
    <span class="sd">&#39;&#39;&#39;Compute energy of spin lattice by lopping over each spin </span>
<span class="sd">        with periodic boundary conditions enforced </span>
<span class="sd">        via rollover index implemented using modulo operator %&#39;&#39;&#39;</span>
    
    <span class="n">E</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>   
            
            <span class="n">z</span> <span class="o">=</span> <span class="n">spins</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="k">N</span>, j] + spins[(i-1)%N, j] +\
                <span class="n">spins</span><span class="p">[</span><span class="n">i</span><span class="p">,(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="k">N</span>] +  spins[i,(j-1)%N]
            
            <span class="n">E</span> <span class="o">+=</span> <span class="o">-</span><span class="n">J</span><span class="o">*</span><span class="n">z</span><span class="o">*</span><span class="n">spins</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="mi">4</span> <span class="c1"># Since we overcounted interactions 4 times divide by 4.</span>

    <span class="k">return</span> <span class="n">E</span> <span class="o">-</span> <span class="n">B</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">spins</span><span class="p">)</span> <span class="c1">#Field contribution added</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getEE</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">B</span><span class="p">):</span>
    
    <span class="sd">&#39;&#39;&#39;Compute energy of spin lattice by lopping over each spin </span>
<span class="sd">    with periodic boundary conditions enforced </span>
<span class="sd">    via numpy roll&#39;&#39;&#39;</span> 
    
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> \
    <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">eij</span> <span class="o">=</span> <span class="o">-</span><span class="n">J</span><span class="o">*</span><span class="n">spins</span><span class="o">*</span><span class="n">z</span><span class="o">/</span><span class="mi">4</span>  
    
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">eij</span><span class="p">)</span> <span class="o">-</span> <span class="n">B</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">spins</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spins</span> <span class="o">=</span> <span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1000</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>it
<span class="n">ee</span> <span class="o">=</span> <span class="n">getE</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="c1">#print(ee)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.44 s ± 6.18 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>it
<span class="n">ee2</span> <span class="o">=</span> <span class="n">getEE</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="c1">#print(ee2)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>14.6 ms ± 231 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getM</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getC</span><span class="p">(</span><span class="n">Ei</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    
    <span class="n">Ei</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Ei</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">Ei</span><span class="p">))</span><span class="o">/</span><span class="n">T</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getXi</span><span class="p">(</span><span class="n">Mi</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    
    <span class="n">Mi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Mi</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">Mi</span><span class="p">))</span><span class="o">/</span><span class="n">T</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getCorr</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
    
    <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="sampliing-of-boltzmann-distribution-nvt-mc-vs-mcmc">
<h3>Sampliing of Boltzmann distribution (NVT). MC vs MCMC<a class="headerlink" href="#sampliing-of-boltzmann-distribution-nvt-mc-vs-mcmc" title="Permalink to this headline">¶</a></h3>
<p>How to compute the expectation value of an observable <span class="math notranslate nohighlight">\(A\)</span>. In theory everything is simple:</p>
<div class="math notranslate nohighlight">
\[P(E_i)=\frac{e^{-\beta E_i}}{Z} = \frac{e^{-\beta E_i}}{\sum_i e^{-\beta E_i}}\]</div>
<div class="math notranslate nohighlight">
\[\langle A\rangle = \sum_i A_iP(E_i)\]</div>
<p><strong>1. Question: What we know and what we want to know?</strong></p>
<ul class="simple">
<li><p>We don’t always know the <strong>(micro)states</strong> <span class="math notranslate nohighlight">\(i\)</span> of a system.</p></li>
<li><p>We only know <strong>macroscopic quantities:</strong> temperature <span class="math notranslate nohighlight">\(T\)</span> with <span class="math notranslate nohighlight">\(\beta = 1/(k_BT)\)</span>, volume, etc.</p></li>
</ul>
<p><strong>2. Answer: MC sampling</strong></p>
<ul class="simple">
<li><p>Simulate different states of the system with Monte Carlo, according to the thermal probability function</p></li>
</ul>
<p><strong>3. What are challanges?</strong></p>
<ul class="simple">
<li><p>most probabilities <span class="math notranslate nohighlight">\(P(E_k)\)</span> are tiny =&gt; exponentially small</p></li>
<li><p>there is an extremely large number of possible states</p></li>
</ul>
<p><strong>4. Concludion: We need Importance sampling!</strong></p>
<ul class="simple">
<li><p>Use the Boltzmann probability <span class="math notranslate nohighlight">\(P(E_i)\)</span> as probability distribution to generate <span class="math notranslate nohighlight">\(N\)</span> samples:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\boxed{\langle A\rangle \rightarrow\frac{1}{N}\sum_{i=1}^N \underbrace{A_i}_{{\rm chosen}\ {\rm acc.}\ {\rm to}\ P(E_i)}}\]</div>
<p><strong>MCMC Simulation</strong> Generating random walks in configuration space of thte system states.</p>
</div>
<div class="section" id="master-equation-and-detailed-balance">
<h3>Master Equation and Detailed Balance<a class="headerlink" href="#master-equation-and-detailed-balance" title="Permalink to this headline">¶</a></h3>
<p><strong>Random process:</strong></p>
<div class="math notranslate nohighlight">
\[P(X_1, X_2, ... X_N) = P_1(X_1)\cdot P_2(X_2)... P_1(X_N)\]</div>
<br>
<p><strong>Probabilities</strong></p>
<div class="math notranslate nohighlight">
\[P(X_1)\]</div>
<div class="math notranslate nohighlight">
\[\sum_{X'} P(X') =1\]</div>
<p><strong>Markov chain:</strong></p>
<div class="math notranslate nohighlight">
\[p(X_1, X_2, ... X_N) = P_1(X_1)\cdot P_2(X_2| X_1) \cdot P_2(X_3| X_2)... P_1(X_N | X_{N-1})\]</div>
<br>
<p><strong>Conditional (transition) probabilities:</strong></p>
<div class="math notranslate nohighlight">
\[T(X_1 \rightarrow X_2) = P(X_2|X_1)\]</div>
<div class="math notranslate nohighlight">
\[\sum_{X'} T(X\rightarrow X') =1 \]</div>
<p><strong>Probability of being at <span class="math notranslate nohighlight">\(X\)</span> at <span class="math notranslate nohighlight">\(t+\Delta t\)</span> given prior state at <span class="math notranslate nohighlight">\((X',t)\)</span></strong></p>
<div class="math notranslate nohighlight">
\[P(X, t+\Delta t) = \sum_X' P(X', t) T(X' \rightarrow X, t)\]</div>
<p><strong>Master equation: A continuity equation in probability space.</strong></p>
<div class="math notranslate nohighlight">
\[P(X, t+\Delta t) -P(X,t)= \sum_X' P(X', t) T(X' \rightarrow X, t) - P(X, t)\sum_{X'} T(X\rightarrow X')\]</div>
<div class="math notranslate nohighlight">
\[\boxed{\frac{\partial P(X,t)}{\partial t} = \sum_X' P(X', t) w(X' \rightarrow X, t) - \sum_{X'} P(X, t) w(X\rightarrow X')}\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(w(X' \rightarrow X, t) = lim_{\Delta t \rightarrow 0}\frac{T(X' \rightarrow X, t)}{\Delta t}\)</span></p></li>
</ul>
</div>
<div class="section" id="detailed-balance-equilibrium">
<h3>Detailed Balance = Equilibrium<a class="headerlink" href="#detailed-balance-equilibrium" title="Permalink to this headline">¶</a></h3>
<br>
<div class="math notranslate nohighlight">
\[\boxed{\frac{\partial P(X,t)}{\partial t}  = \sum_{X'} P(X', t) w_{X'X} - \sum_{X'} P(X, t) w_{X X'}}=0\]</div>
<br>
<div class="math notranslate nohighlight">
\[\boxed{ p_i w_{ij} = p_j w_{ji}  }\]</div>
<p><strong>Master equation for a two state dynamics</strong></p>
<div class="math notranslate nohighlight">
\[\frac{dP(x_1,t)}{dt} = p_1 w_{12} - p_2 w_{21}\]</div>
<div class="math notranslate nohighlight">
\[\frac{dP(x_2,t)}{dt} = p_2 w_{21} - p_1 w_{12}\]</div>
</div>
<div class="section" id="how-to-pick-the-moves-for-markov-chain">
<h3>How to pick the moves for Markov chain?<a class="headerlink" href="#how-to-pick-the-moves-for-markov-chain" title="Permalink to this headline">¶</a></h3>
<div class="math notranslate nohighlight">
\[[transition] = [move] \cdot [acceptance]\]</div>
<div class="math notranslate nohighlight">
\[T(X\rightarrow X') = \alpha_{X X'}\cdot A_{X X'} \]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\alpha_{X X'}\geq 0\)</span>, <span class="math notranslate nohighlight">\(\alpha_{X X'} = \alpha_{X' X}\)</span>
<br></p></li>
<li><p>If <span class="math notranslate nohighlight">\(p(X') &lt; p(X)\)</span>, <span class="math notranslate nohighlight">\(A_{XX'}=\frac{p(X')}{p(X)}\)</span>
<br></p></li>
<li><p>If <span class="math notranslate nohighlight">\(p(X') \geq p(X)\)</span>, <span class="math notranslate nohighlight">\(A_{XX'}=1\)</span></p></li>
</ul>
<p><strong>For 2D Ising model of size <span class="math notranslate nohighlight">\((L,L)\)</span></strong></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\alpha_{X X'} = \frac{1}{L^2}\)</span></p></li>
</ul>
<p>Where <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(X'\)</span> differ in one spin configuration.</p>
</div>
</div>
<div class="section" id="metropolis-algorithm">
<h2>Metropolis algorithm<a class="headerlink" href="#metropolis-algorithm" title="Permalink to this headline">¶</a></h2>
<p><span class="math notranslate nohighlight">\({\bf i. Initialization.}\)</span> Generate some initiaal configuration for spins <span class="math notranslate nohighlight">\([s_0]=(s_1,...s_N)\)</span>. For instnace Choosing random orientation for each spins <span class="math notranslate nohighlight">\((+1, -1)\)</span> or giving them  the same orientation.</p>
<p><span class="math notranslate nohighlight">\({\bf ii. Attempt\,\, spin\,\, flip.\,\,}\)</span> Pick a spin at random and flip it. E.g multiply by -1 so that +1 state becomes -1 and vice versa. this generated a new configuration <span class="math notranslate nohighlight">\([s_1]\)</span></p>
<p><span class="math notranslate nohighlight">\({\bf iii. Acceptance/Rejection}\)</span> Evaluate energy differene between old configuration <span class="math notranslate nohighlight">\([s_{0}]\)</span> and new one <span class="math notranslate nohighlight">\([s_{1}]\)</span> with flipped spin which has created in previous step. The <span class="math notranslate nohighlight">\(\Delta E=E_{1}-E_{0}\)</span> is used for deciding weather the move is accepted or rejected in a way that is consistent with Boltzman distribution:</p>
<div class="math notranslate nohighlight">
\[w=\frac{P[s_{1}]}{P[s_{0}]}=exp\big(-\beta[E_{1}-E_{0}] \big ) \]</div>
<p>This is done by generating a unifor random number <span class="math notranslate nohighlight">\(r\)</span> between <span class="math notranslate nohighlight">\([0,1]\)</span> and</p>
<p>(a) if <span class="math notranslate nohighlight">\(r  \leq w\)</span> Accept the spin flip thereby keeping <span class="math notranslate nohighlight">\([s_1]\)</span> and proceeding to try new spin flip via step ii.</p>
<p>(b) if <span class="math notranslate nohighlight">\(r  &gt; w\)</span> reject the spin flip and set  <span class="math notranslate nohighlight">\([s_1]=[s_0]\)</span> and proceeding to try a new spin flip via step ii.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    
    <span class="sd">&#39;&#39;&#39;Create square lattice of spin states, stored as 2D numpy array&#39;&#39;&#39;</span>  
                        
    <span class="n">spins</span> <span class="o">=</span> <span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>  
    
    <span class="k">return</span> <span class="n">spins</span>    
    

<span class="k">def</span> <span class="nf">get_dE</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span> 
    
    <span class="sd">&#39;&#39;&#39;Compute energy difference betwee old and spin flipped configuration.</span>
<span class="sd">    Peridoic boundary conditions have been imposed. </span>
<span class="sd">    Study this function carefully and understand the meaning of each term&#39;&#39;&#39;</span>
    
    <span class="n">z</span> <span class="o">=</span> <span class="n">spins</span><span class="p">[(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="k">N</span>, j] + spins[(i+1)%N, j] + spins[i, (j-1)%N] + spins[i, (j+1)%N]
    
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">spins</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">J</span><span class="o">*</span><span class="n">z</span> <span class="o">+</span> <span class="n">B</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">mcmc</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    
    <span class="sd">&#39;&#39;&#39; Attempt a flip of a randomly chosen spin at ij location of lattice&#39;&#39;&#39;</span> 
    
    <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">choice</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    
    <span class="n">deltaE</span> <span class="o">=</span> <span class="n">get_dE</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">deltaE</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">deltaE</span><span class="o">/</span><span class="n">T</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">random</span><span class="p">():</span>
        
        <span class="sd">&#39;&#39;&#39;For negative dE always accept or for positive dE distribute acceptance according to Boltzman dist&#39;&#39;&#39;</span>
        
        <span class="n">spins</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
    
    <span class="k">return</span> <span class="n">spins</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span><span class="o">=</span><span class="mi">250</span>
<span class="n">J</span><span class="o">=</span><span class="mi">1</span>
<span class="n">B</span><span class="o">=</span><span class="mi">0</span>
<span class="n">n_mcsteps</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">T</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># Try different temps. For J=1 vary T between 1-3 to see qualitative change. </span>

<span class="sd">&#39;&#39;&#39; We run the Monte Carlo using a loop of n_mcsteps iterations. Later one we can create a more </span>
<span class="sd">sophisticated object oriented code where one can simply execute single command. &#39;&#39;&#39;</span>

<span class="n">spins</span> <span class="o">=</span> <span class="n">initialize</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_mcsteps</span><span class="p">):</span>
    
    <span class="n">spins</span> <span class="o">=</span> <span class="n">mcmc</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>

<span class="c1"># Plot the lattice before and after</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;spin, $ s_i$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;spin, $ s_j$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">spins</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/01_MCMC_46_0.png" src="../_images/01_MCMC_46_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">64</span>
<span class="n">J</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">B</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">0.7</span>  

<span class="n">n_steps</span> <span class="o">=</span> <span class="mi">100000</span>
<span class="n">spins</span> <span class="o">=</span> <span class="n">initialize</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

<span class="n">images</span><span class="o">=</span><span class="p">[]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_steps</span><span class="p">):</span>
    
    <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spins</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span> <span class="c1"># use copy becasue spins keep on being updates</span>
    
    <span class="n">spins</span> <span class="o">=</span> <span class="n">mcmc</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
<span class="o">%</span><span class="k">time</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 2 µs, sys: 1 µs, total: 3 µs
Wall time: 5.96 µs
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@widgets</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_steps</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">plot_image</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">images</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"version_major": 2, "version_minor": 0, "model_id": "09f0c341cb8945d1be33df84bdc7c15a"}
</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span><span class="o">=</span><span class="mi">10</span>
<span class="n">J</span><span class="o">=</span><span class="mi">1</span>
<span class="n">B</span><span class="o">=</span><span class="mi">0</span>

<span class="n">n_mcsteps</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">n_mcsteps2</span> <span class="o">=</span> <span class="mi">20000</span>

<span class="n">T</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Try different temps. For J=1 vary T between 1-3 to see qualitative change. </span>

<span class="sd">&#39;&#39;&#39; Record some observables form simulation and plot as a function of time to visually inspect equilibration&#39;&#39;&#39;</span>

<span class="n">obs</span><span class="p">,</span> <span class="n">obs2</span><span class="p">,</span> <span class="n">obs3</span><span class="p">,</span>  <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>


<span class="n">spins</span> <span class="o">=</span> <span class="n">initialize</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_mcsteps</span><span class="p">):</span>
    
    <span class="n">spins</span> <span class="o">=</span> <span class="n">mcmc</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_mcsteps2</span><span class="p">):</span>
    
    <span class="n">spins</span> <span class="o">=</span> <span class="n">mcmc</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
    
    <span class="n">obs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">spins</span><span class="p">))</span>
    
<span class="c1">#    obs2.append(spins[1,5])</span>
    <span class="c1">#obs3.append(getE(spins,N,J,B))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7faddeebf950&gt;]
</pre></div>
</div>
<img alt="../_images/01_MCMC_51_1.png" src="../_images/01_MCMC_51_1.png" />
</div>
</div>
<div class="section" id="carry-out-explorative-simulations">
<h3>Carry out explorative simulations<a class="headerlink" href="#carry-out-explorative-simulations" title="Permalink to this headline">¶</a></h3>
<p><span class="math notranslate nohighlight">\(\bf{i.}\)</span> Test the dependence of observables on system size.</p>
<p><span class="math notranslate nohighlight">\(\bf{ii.}\)</span> Test the dependence of observables on initital conditions.</p>
<p><span class="math notranslate nohighlight">\(\bf{iii.}\)</span> Vary intensive parameters, e.g temperature and field strength. Investigate changes in observables such as magnetization, energy, susceptibility, heat capacity.</p>
<p><span class="math notranslate nohighlight">\(\bf{iv.}\)</span> How do we know if simulation has done enough sampling? How do we assess covnergence and errors?</p>
<p><span class="math notranslate nohighlight">\(\bf{v.}\)</span> Think about alternative ways of accelerating and enhancing the sampling.</p>
<div class="section" id="parameter-sweeps-run-mc-simulatons-of-2d-ising-model-at-different-ts">
<h4>Parameter sweeps: run MC simulatons  of 2D Ising model at different  Ts<a class="headerlink" href="#parameter-sweeps-run-mc-simulatons-of-2d-ising-model-at-different-ts" title="Permalink to this headline">¶</a></h4>
<p>For more rigirous analysis we can either optimize the code (using cython or numba) or run on HPCs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>                       <span class="c1"># Small trial system, e.g 10-20 spins</span>
<span class="n">J</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">B</span><span class="o">=</span><span class="mi">0</span>
<span class="n">Ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span> <span class="c1">#vary temp</span>

<span class="n">n_mcsteps</span><span class="o">=</span><span class="mi">10000</span>   <span class="c1"># Equilibrate!</span>
<span class="n">n_mcsteps2</span><span class="o">=</span><span class="mi">20000</span>   <span class="c1"># Collect data!</span>


<span class="c1">###Carry out mulitple MC runs at differnet Temperatures. This calculation may take ~5 mins. Think about equilibration, convergence and statistical errors</span>

<span class="n">Es</span><span class="p">,</span> <span class="n">Ms</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="n">Cs</span><span class="p">,</span> <span class="n">Xis</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>   

<span class="k">for</span> <span class="n">T</span> <span class="ow">in</span> <span class="n">Ts</span><span class="p">:</span>
    
    <span class="n">Ei</span><span class="p">,</span><span class="n">Mi</span><span class="o">=</span><span class="p">[],[]</span>
    
    <span class="n">spins</span> <span class="o">=</span> <span class="n">initialize</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_mcsteps</span><span class="p">):</span>
        
        <span class="n">spins</span> <span class="o">=</span> <span class="n">mcmc</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_mcsteps2</span><span class="p">):</span>  
        
        <span class="n">spins</span> <span class="o">=</span> <span class="n">mcmc</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
        
        <span class="n">Ei</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getE</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span><span class="n">N</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">B</span><span class="p">))</span>
        <span class="n">Mi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getM</span><span class="p">(</span><span class="n">spins</span><span class="p">))</span>
 

    <span class="c1"># First L steps discarded as equilibration</span>
    <span class="n">Es</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Ei</span><span class="p">))</span>
    <span class="n">Ms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Mi</span><span class="p">))</span>
    
    <span class="c1"># C and Xi computed from energies </span>
    <span class="n">Cs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getC</span><span class="p">(</span><span class="n">Ei</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
    <span class="n">Xis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getXi</span><span class="p">(</span><span class="n">Ei</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ipykernel_2000</span><span class="o">/</span><span class="mf">3295904899.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span>         <span class="n">spins</span> <span class="o">=</span> <span class="n">mcmc</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span> 
<span class="ne">---&gt; </span><span class="mi">29</span>         <span class="n">Ei</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getE</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span><span class="n">N</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">B</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span>         <span class="n">Mi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getM</span><span class="p">(</span><span class="n">spins</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">31</span> 

<span class="nn">/tmp/ipykernel_2000/1270693805.py</span> in <span class="ni">getE</span><span class="nt">(spins, N, J, B)</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> 
<span class="g g-Whitespace">     </span><span class="mi">12</span>             <span class="n">z</span> <span class="o">=</span> <span class="n">spins</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="k">N</span>, j] + spins[(i-1)%N, j] +\
<span class="ne">---&gt; </span><span class="mi">13</span>                 <span class="n">spins</span><span class="p">[</span><span class="n">i</span><span class="p">,(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="k">N</span>] +  spins[i,(j-1)%N]
<span class="g g-Whitespace">     </span><span class="mi">14</span> 
<span class="g g-Whitespace">     </span><span class="mi">15</span>             <span class="n">E</span> <span class="o">+=</span> <span class="o">-</span><span class="n">J</span><span class="o">*</span><span class="n">z</span><span class="o">*</span><span class="n">spins</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="mi">4</span> <span class="c1"># Since we overcounted interactions 4 times divide by 4.</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Ts</span><span class="p">,</span> <span class="n">Es</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Energy of a </span><span class="si">%d</span><span class="s2">x</span><span class="si">%d</span><span class="s2"> spin lattice&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Temperature T&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Energy E&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Energy E&#39;)
</pre></div>
</div>
<img alt="../_images/01_MCMC_55_1.png" src="../_images/01_MCMC_55_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Ts</span><span class="p">,</span> <span class="n">Ms</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Magnetization of a </span><span class="si">%d</span><span class="s2">x</span><span class="si">%d</span><span class="s2"> spin lattice&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Temperature T&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Magnetization M&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Magnetization M&#39;)
</pre></div>
</div>
<img alt="../_images/01_MCMC_56_1.png" src="../_images/01_MCMC_56_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Ts</span><span class="p">,</span> <span class="n">Cs</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Heat Capacity of a </span><span class="si">%d</span><span class="s2">x</span><span class="si">%d</span><span class="s2"> spin lattice&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Temperature T&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Heat capacity $C_v(T)$&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Heat capacity $C_v(T)$&#39;)
</pre></div>
</div>
<img alt="../_images/01_MCMC_57_1.png" src="../_images/01_MCMC_57_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Ts</span><span class="p">,</span> <span class="n">Xis</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Suscpetibility of a </span><span class="si">%d</span><span class="s2">x</span><span class="si">%d</span><span class="s2"> spin lattice&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Temperature T&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Susceptibility $\Xi(T)$&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Susceptibility $\\Xi(T)$&#39;)
</pre></div>
</div>
<img alt="../_images/01_MCMC_58_1.png" src="../_images/01_MCMC_58_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ising2D python code optimized for speed</span>

<span class="kn">import</span> <span class="nn">numpy</span>  <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">jit</span><span class="p">,</span> <span class="n">njit</span>

<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">compute_ising2d</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Computes thermodynamic variables given the spin lattice&#39;&#39;&#39;</span>
  
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spins</span><span class="p">)</span>

    <span class="n">E</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>   
            <span class="n">z</span> <span class="o">=</span> <span class="n">spins</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="k">N</span>, j] + spins[(i-1)%N, j] +spins[i,(j+1)%N] +  spins[i,(j-1)%N]
                
            <span class="n">E</span> <span class="o">+=</span> <span class="o">-</span><span class="n">J</span><span class="o">*</span><span class="n">z</span><span class="o">*</span><span class="n">spins</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="mi">4</span> <span class="c1"># Since we overcounted interactions 4 times divide by 4.</span>

    <span class="c1">#Energy</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">E</span><span class="o">/</span><span class="n">N</span> <span class="o">-</span> <span class="n">B</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">spins</span><span class="p">)</span> 

    <span class="c1">#Magnetization</span>
    <span class="n">M</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">spins</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">M</span><span class="p">,</span> <span class="n">E</span>  

<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">run_ising2d</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">n_steps</span><span class="p">,</span> <span class="n">out_freq</span><span class="p">):</span>

    <span class="c1">#Initialize data arrays</span>
    <span class="n">M</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">traj</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spins</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_steps</span><span class="p">):</span>

        <span class="c1">#Pick random spin</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

        <span class="c1">#Compute energy change due to a flip of spin at i,j</span>
        <span class="n">z</span>  <span class="o">=</span> <span class="n">spins</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="k">N</span>, j] + spins[(i-1)%N, j] + spins[i, (j+1)%N] + spins[i, (j-1)%N] 
        <span class="n">dE</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">spins</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">J</span><span class="o">*</span><span class="n">z</span> <span class="o">+</span> <span class="n">B</span><span class="p">)</span>

        <span class="c1">#Metropolis condition</span>
        <span class="k">if</span> <span class="n">dE</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dE</span><span class="o">/</span><span class="n">T</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">():</span>
          
            <span class="n">spins</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span> 

        <span class="c1">#Compute and store data</span>
        <span class="k">if</span> <span class="n">step</span> <span class="o">%</span> <span class="n">out_freq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

            <span class="n">M_t</span><span class="p">,</span> <span class="n">E_t</span> <span class="o">=</span> <span class="n">compute_ising2d</span><span class="p">(</span><span class="n">spins</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
            
            <span class="n">M</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">M_t</span><span class="p">)</span>
            <span class="n">E</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_t</span><span class="p">)</span>
            <span class="n">traj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spins</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">traj</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">M</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">traj</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">M</span> <span class="o">=</span> <span class="n">run_ising2d</span><span class="p">(</span><span class="n">spins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">120</span><span class="p">,</span> <span class="mi">120</span><span class="p">)),</span> <span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">n_steps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e7</span><span class="p">),</span> <span class="n">out_freq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 1.62 s, sys: 207 ms, total: 1.83 s
Wall time: 1.82 s
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="problems">
<h3>Problems<a class="headerlink" href="#problems" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="problem-1">
<h3>Problem-1<a class="headerlink" href="#problem-1" title="Permalink to this headline">¶</a></h3>
<p>Revisit the example MCMC simulation for determining <span class="math notranslate nohighlight">\(\pi\)</span> value. Vary the size of the displacement to determine the optimal size that generates quickest convergence to the value of <span class="math notranslate nohighlight">\(\pi\)</span></p>
</div>
<div class="section" id="problem-2">
<h3>Problem-2<a class="headerlink" href="#problem-2" title="Permalink to this headline">¶</a></h3>
<p>Carry out MC simulation of 2D ising spin model for various lattice sizes <span class="math notranslate nohighlight">\(N= 16,32, 64\)</span> at temperatures above and below critical e.g <span class="math notranslate nohighlight">\(T&lt;T_c\)</span> and <span class="math notranslate nohighlight">\(T&gt;T_c\)</span>.</p>
<ul class="simple">
<li><p>How long does it take to equilibrate system as a function of size and as a function of T?</p></li>
<li><p>Plot some observables as a function of number of samples states to show that the system is carrying out some sort of random walk in the configurational space.</p></li>
<li><p>How do profiles of Energy vs T, Magnetization vs T and heat capacity vs T, and susceptibility vs T change as a function of size of our lattice.</p></li>
<li><p>Does <span class="math notranslate nohighlight">\(J&gt;0\)</span> and <span class="math notranslate nohighlight">\(J&lt;0\)</span> change the nature of phase transition?</p></li>
</ul>
</div>
<div class="section" id="problem-3">
<h3>Problem-3<a class="headerlink" href="#problem-3" title="Permalink to this headline">¶</a></h3>
<p>Compute correlation functions of spin variable, that is how correlated are spins as a function of distance on a lattice, <span class="math notranslate nohighlight">\(L\)</span>. <span class="math notranslate nohighlight">\(C(L)=\langle s_i s_{i+L}\rangle -\langle s_i\rangle \langle s_{i+L}\rangle \)</span> Make sure to account for the periodic boundary conditions!</p>
<blockquote>
<div><p>Note that you can pick a special tagged spin and calculate correlation function of taged spin (<span class="math notranslate nohighlight">\(s_13\)</span> for instance) with any other as a function of lattice spearation  by averaging over produced MC configurations.  Or you can take advantage of the fact that there are no priviledged spins and average over many spins and average over MC configruations e.g <span class="math notranslate nohighlight">\(s_1, s_2, ...\)</span>. E.g you can pick a horizontal line of spins and run a summation for each fixed r_ab distance.</p>
</div></blockquote>
</div>
<div class="section" id="problem-4">
<h3>Problem-4<a class="headerlink" href="#problem-4" title="Permalink to this headline">¶</a></h3>
<p>Take a 20 by 20 lattice and equilibriate the system with a value of extneral field B equal to +1.
Now slowly change h to −1 in discrete steps during each of these steps, use the previously equilibriated
configuration as an input to the system to undergo equilibriation again.</p>
<p>Caluclate average and variance quantities (e.g E, M, C etc). Notice anything interesing :)</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "DPotoyan/Statmech4ChemBio",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./6_ising"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="intro.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Phase transitions and Ising models</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="02_ising_analytic.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Phase transitions through the lense of Ising models</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Davit Potoyan<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>