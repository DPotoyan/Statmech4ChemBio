
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3. “Monte Carlo and the power of randomness” &#8212; Statistical Mechanics for Chemistry and Biology</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e7340bb3dbd8dde6db86f25597f54a1b.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4. Appendix B1: Probability distirbutions functions (PDFs) and Limit theorems" href="04_LimitTheorems.html" />
    <link rel="prev" title="2. Random variable, stochastic process and simulation." href="02_RandVar.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.jpg" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Statistical Mechanics for Chemistry and Biology</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Introduction
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../00_python.html">
   A. Python refresher
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../00_python/intro2py.html">
     1. Why Python?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../00_python/intro2numpy.html">
     2. NumPy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../00_python/intro2viz.html">
     3. Plotting
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 current active collapsible-parent">
  <a class="reference internal" href="../01_stats.html">
   B. Probability and randomness
  </a>
  <ul class="current collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="01_SetsCounting.html">
     1. Probability by counting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02_RandVar.html">
     2. Random variable, stochastic process and simulation.
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     3. “Monte Carlo and the power of randomness”
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04_LimitTheorems.html">
     4. Appendix B1: Probability distirbutions functions (PDFs) and Limit theorems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05_InverseTransform.html">
     5. Appendix B2: The Inverse Transform of RVs
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../02_thermo.html">
   C. Thermodynamics refresher
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../02_thermo/01_Thermo.html">
     1. Review of thermodynamics principles
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../03_ensembles.html">
   D. Statistical ensembles
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../03_ensembles/01_NVE.html">
     1. NVE
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03_ensembles/02_NVT.html">
     2. NVT
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03_ensembles/03_NPT.html">
     3. NPT
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03_ensembles/04_Applications.html">
     4. Applications
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03_ensembles/05_Phase_space_dynamics.html">
     5. NVE
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../04_ideal_systems.html">
   E. Ideal Systems
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../04_ideal_systems/01_Classical.html">
     1. Classical gases
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04_ideal_systems/02_Quantum.html">
     2. Quantum non-interacting systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04_ideal_systems/03_Photons_Phonons.html">
     3. Photons and Phonons
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../05_entropy.html">
   F. Entropy and Information
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../05_entropy/01_InformationEnt.html">
     1. What is Information?
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../06_ising.html">
   G. Phase transitions and Ising models
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../06_ising/01_MCMC_Ising.html">
     1. Ising models and Metropolis-Hastings algorithm
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06_ising/02_ising_analytic.html">
     2. Phase transitions through the lense of Ising models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06_ising/03_EnhanceSampl.html">
     3. Non-boltzman (enhanced) sampling ideas
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/01_stats/03_MC.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/DPotoyan/Statmech4ChemBio/master?urlpath=lab/tree/01_stats/03_MC.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/DPotoyan/Statmech4ChemBio/blob/master/01_stats/03_MC.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i>
            Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#throughing-pebbles-on-the-beach-and-estimatiing-pi">
   3.1. Throughing pebbles on the beach and estimatiing pi
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#shapes-more-complex-than-a-circle">
   3.2. Shapes more complex than a circle
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#basic-idea-behind-monte-carlo">
   3.3. Basic Idea behind Monte Carlo
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#computing-expectations-by-drawing-random-numbers">
     3.3.1. Computing expectations by drawing random numbers
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#variance-shrinks-as-n-0-5-thanks-to-lln-clt">
     3.3.2. Variance shrinks as
     <span class="math notranslate nohighlight">
      \(N^{0.5}\)
     </span>
     thanks to LLN, CLT.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-essence-of-mc-casting-integrals-as-epexctations">
     3.3.3. The essence of MC: Casting integrals as epexctations!
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-monte-carlo-evaluation-of-a-definite-integral">
     3.3.4. Using Monte Carlo: evaluation of a definite integral
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#intuition-for-error-rate-why-monte-carlo-can-beat-brute-force-integration">
     3.3.5. Intuition for error rate: Why Monte Carlo can beat brute force integration.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-3-of-using-monte-carlo-monitoring-the-convergence-decresase-of-variance">
     3.3.6. Example-3 of using Monte Carlo: monitoring the convergence (decresase of variance)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#on-variance-reduction">
     3.3.7. On variance Reduction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#importance-sampling">
     3.3.8. Importance sampling
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-of-importance-sampling">
     3.3.9. Example of importance sampling
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#markov-chains">
   3.4. Markov Chains
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#eigenvector-solution">
     3.4.1. Eigenvector solution
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#population-dynamics-as-a-markov-chain-simultion">
     3.4.2. Population dynamics as a  markov chain simultion
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#consider-many-independent-trials-now">
     3.4.3. Consider many independent trials now.
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#problems">
   3.5. Problems
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#problem-1-confined-diffusion">
     3.5.1. Problem-1: Confined diffusion.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#problem-2-continuous-time-random-walk-ctrw">
     3.5.2. Problem-2: continuous time random walk (CTRW)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#problem-3-breaking-the-clt-cauchy-vs-normal-random-walk-in-2d">
     3.5.3. Problem-3: Breaking the CLT; Cauchy vs Normal random walk in 2D
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#problem-4-mc-the-crude-version">
     3.5.4. Problem-4: MC, the crude version
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#problem-5-mc-method-for-evaluating-1d-and-2d-integrals">
     3.5.5. Problem-5 MC method for evaluating 1D and 2D integrals
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="monte-carlo-and-the-power-of-randomness">
<h1><span class="section-number">3. </span>“Monte Carlo and the power of randomness”<a class="headerlink" href="#monte-carlo-and-the-power-of-randomness" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sci</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="throughing-pebbles-on-the-beach-and-estimatiing-pi">
<h2><span class="section-number">3.1. </span>Throughing pebbles on the beach and estimatiing pi<a class="headerlink" href="#throughing-pebbles-on-the-beach-and-estimatiing-pi" title="Permalink to this headline">¶</a></h2>
<p>The idea behind the program is that the ratio of the area of the  circle to the square area that inscribes it is <span class="math notranslate nohighlight">\(\pi/4\)</span>, so by counting the fraction of the random points in the square that are inside the circle, we get increasingly good estimates to <span class="math notranslate nohighlight">\(\pi\)</span>.</p>
<div class="math notranslate nohighlight">
\[V_{c}/V_{s} = \pi r^2 / (2r)^2 = \frac{\pi}{4}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">circle_pi_estimate</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">r0</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Generate random points in the square with sides of -r0 and r0.</span>
<span class="sd">      Count the fraction of points falling inside the inscribed circle. Estimate pi</span>
<span class="sd">      &#39;&#39;&#39;</span>
  
    <span class="c1"># Generate random points</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">r0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">r0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>

    <span class="c1">#Convert points to boolean array corresdponding to points being inside vs outside</span>
    <span class="n">pinside</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">xs</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ys</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">r0</span> 
    <span class="n">poutside</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">xs</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ys</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">r0</span>
    
    <span class="n">pi_estimate</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">pinside</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">N</span> 
    
    <span class="c1"># Plots points </span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">pinside</span><span class="p">],</span>  <span class="n">ys</span><span class="p">[</span><span class="n">pinside</span><span class="p">],</span> <span class="s1">&#39;b.&#39;</span><span class="p">)</span> <span class="c1"># points inside are blue</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">poutside</span><span class="p">],</span> <span class="n">ys</span><span class="p">[</span><span class="n">poutside</span><span class="p">],</span><span class="s1">&#39;r.&#39;</span><span class="p">)</span> <span class="c1"># points outside are red</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Estimation of $\pi$=&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pi_estimate</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">circle_pi_estimate</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">r0</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_MC_5_0.png" src="../_images/03_MC_5_0.png" />
</div>
</div>
</div>
<div class="section" id="shapes-more-complex-than-a-circle">
<h2><span class="section-number">3.2. </span>Shapes more complex than a circle<a class="headerlink" href="#shapes-more-complex-than-a-circle" title="Permalink to this headline">¶</a></h2>
<div class="math notranslate nohighlight">
\[I = \int_0^2 \sin^2(\frac{1}{x(2-x)})dx\]</div>
<p>We will solve this problem using the same technique.  From the curve, we approximately could draw a rectangle to cover the curve in which x=[0,2], y = [0,1]. The area(volume for higher dimensions) of the rectangle is simply <span class="math notranslate nohighlight">\(A\)</span>=2. And the area under the curve is <span class="math notranslate nohighlight">\(I\)</span> which appears to be difficult to solve. If we choose a point uniformly at random in the rectangle, What’s the probability that the point falls into the region under the curve? It is obviously that <span class="math notranslate nohighlight">\(p\)</span> = <span class="math notranslate nohighlight">\(I/A\)</span>.</p>
<ol class="simple">
<li><p>Generate a large number of <span class="math notranslate nohighlight">\(N\)</span> random points in the bouding rectangle</p></li>
<li><p>Count number of points <span class="math notranslate nohighlight">\(n\)</span> which are falling under the curve.</p></li>
<li><p>Estimate area according to <span class="math notranslate nohighlight">\(I=Ap=A\frac{n}{N}\)</span></p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mc_integral</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">Lx</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">Ly</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Generate random points in the square with sides of -r0 and r0.</span>
<span class="sd">      Count the fraction of points falling inside the inscribed circle. Estimate pi</span>
<span class="sd">      &#39;&#39;&#39;</span>
  
    <span class="c1"># Generate uniform random numbers</span>
    <span class="n">ux</span> <span class="o">=</span> <span class="n">Lx</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> 
    <span class="n">uy</span> <span class="o">=</span> <span class="n">Ly</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> 

    <span class="c1">#Count accepted point.  </span>
    <span class="n">pinside</span>  <span class="o">=</span> <span class="n">uy</span><span class="o">&lt;</span><span class="n">func</span><span class="p">(</span><span class="n">ux</span><span class="p">)</span>
    <span class="n">poutside</span> <span class="o">=</span> <span class="n">uy</span><span class="o">&gt;</span><span class="n">func</span><span class="p">(</span><span class="n">ux</span><span class="p">)</span>

    <span class="c1"># Total area times fraction of sucessful points</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">Lx</span><span class="o">*</span><span class="n">Ly</span><span class="o">*</span><span class="n">pinside</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="n">N</span> 

    <span class="c1"># Plots points</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ux</span><span class="p">[</span><span class="n">pinside</span><span class="p">],</span>  <span class="n">uy</span><span class="p">[</span><span class="n">pinside</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ux</span><span class="p">[</span><span class="n">poutside</span><span class="p">],</span> <span class="n">uy</span><span class="p">[</span><span class="n">poutside</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">Lx</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;I =  </span><span class="si">{</span><span class="n">I</span><span class="si">}</span><span class="s1"> with N=</span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s1"> samples&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="n">x</span><span class="p">)))</span> <span class="p">)</span><span class="o">**</span><span class="mi">2</span>

<span class="n">mc_integral</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">Lx</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">Ly</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.7.10/x64/lib/python3.7/site-packages/ipykernel_launcher.py:2: RuntimeWarning: divide by zero encountered in true_divide
  
/opt/hostedtoolcache/Python/3.7.10/x64/lib/python3.7/site-packages/ipykernel_launcher.py:2: RuntimeWarning: invalid value encountered in sin
  
</pre></div>
</div>
<img alt="../_images/03_MC_9_1.png" src="../_images/03_MC_9_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mc_randnum_sample</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">Lx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Ly</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Sample random variables accordin </span>
<span class="sd">    to a distribution.</span>
<span class="sd">    func: given prob dist</span>
<span class="sd">    N:    random numbers used for sampling and rejection</span>
<span class="sd">    Lx, Ly range and domain size of distribution</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># uniform random samples</span>
    <span class="n">ux</span> <span class="o">=</span>     <span class="n">Lx</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">uy</span> <span class="o">=</span>     <span class="n">Ly</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>  

    <span class="c1">#rejection criteria</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">uy</span><span class="o">&lt;=</span><span class="n">func</span><span class="p">(</span><span class="n">ux</span><span class="p">)</span>          
    
    <span class="n">sampled_ux</span> <span class="o">=</span> <span class="n">ux</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

    <span class="c1">### Plotting    </span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Lx</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sampled_ux</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> 
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mf">2.</span><span class="o">/</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">12</span>

<span class="n">mc_randnum_sample</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">Lx</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">Ly</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.7.10/x64/lib/python3.7/site-packages/ipykernel_launcher.py:2: RuntimeWarning: divide by zero encountered in true_divide
  
</pre></div>
</div>
<img alt="../_images/03_MC_11_1.png" src="../_images/03_MC_11_1.png" />
</div>
</div>
</div>
<div class="section" id="basic-idea-behind-monte-carlo">
<h2><span class="section-number">3.3. </span>Basic Idea behind Monte Carlo<a class="headerlink" href="#basic-idea-behind-monte-carlo" title="Permalink to this headline">¶</a></h2>
<p>The basic idea of Monte Carlo integration is simple. Suppose you want to find the value of the following integral in some region with volume <span class="math notranslate nohighlight">\(V\)</span>:</p>
<div class="math notranslate nohighlight">
\[I = \int_a^b f(x) dx\]</div>
<p>Monte Carlo integration estimates this integral by computing the fraction of random points that fall under <span class="math notranslate nohighlight">\(f(x)\)</span>  curve multiplied by <span class="math notranslate nohighlight">\(V\)</span>. In other words we are follwing the same procedure as for evaluating pi but this time our area is the area under some general function instead of a circle inscribed in a square.</p>
<div class="section" id="computing-expectations-by-drawing-random-numbers">
<h3><span class="section-number">3.3.1. </span>Computing expectations by drawing random numbers<a class="headerlink" href="#computing-expectations-by-drawing-random-numbers" title="Permalink to this headline">¶</a></h3>
<p>Using probability language, Monte Carlo simulation tallows us to obtain an estimate of the expectation</p>
<div class="math notranslate nohighlight">
\[
E[g(X)] = \int g(x) p(x) dx
\]</div>
<div class="math notranslate nohighlight">
\[
\bar{g}_n = \frac{1}{n} \sum_{i=1}^n g(x_i)
\]</div>
<p>where points <span class="math notranslate nohighlight">\(x_i \sim p\)</span> are draw from the probability density <span class="math notranslate nohighlight">\(p\)</span>.</p>
</div>
<div class="section" id="variance-shrinks-as-n-0-5-thanks-to-lln-clt">
<h3><span class="section-number">3.3.2. </span>Variance shrinks as <span class="math notranslate nohighlight">\(N^{0.5}\)</span> thanks to LLN, CLT.<a class="headerlink" href="#variance-shrinks-as-n-0-5-thanks-to-lln-clt" title="Permalink to this headline">¶</a></h3>
<p>Sine random variables are i.i.d we can use Central Limit Theorem toestimate the Monte Carlo variance of the approximation as</p>
<div class="math notranslate nohighlight">
\[
\sigma^2_n = \frac{1}{n^2} \sum_{i=1}^n (g(x_i) - \bar{g_n})^2)
\]</div>
<p>Also, according to Central Limit Theorem, expectation of sum of random variables scaled by standard deviaton tends to normal distribution:</p>
<div class="math notranslate nohighlight">
\[
\frac{\bar{g_n} - E[g(X)]}{\sigma_n} \sim \mathcal{N}(0, 1)
\]</div>
<p>Therefore the convergence of Monte Carlo integration is <span class="math notranslate nohighlight">\(\mathcal{0}(n^{1/2})\)</span> and independent of the dimensionality. Hence Monte Carlo integration generally beats numerical integration for moderate- and high-dimensional integration since numerical integration (quadrature) converges as <span class="math notranslate nohighlight">\(\mathcal{0}(n^{d})\)</span>. Even for low dimensional problems, Monte Carlo integration may have an advantage when the volume to be integrated is concentrated in a very small region and we can use information from the distribution to draw samples more often in the region of importance.</p>
</div>
<div class="section" id="the-essence-of-mc-casting-integrals-as-epexctations">
<h3><span class="section-number">3.3.3. </span>The essence of MC: Casting integrals as epexctations!<a class="headerlink" href="#the-essence-of-mc-casting-integrals-as-epexctations" title="Permalink to this headline">¶</a></h3>
<p>Back to evaluating integrals. We want to have an efficient way of finding integrals like this:</p>
<div class="math notranslate nohighlight">
\[I = \int{f(x)} \, dx\]</div>
<p>Consider the expectation of a function <span class="math notranslate nohighlight">\(g(x)\)</span> with respect to some distribution <span class="math notranslate nohighlight">\(p(x)\)</span>. By definition, we have</p>
<div class="math notranslate nohighlight">
\[
E[g(x)] = \int{g(x) \, p(x) \, dx}
\]</div>
<p>If we choose <span class="math notranslate nohighlight">\(g(x) = f(x)/p(x)\)</span>, then we have</p>
<div class="math notranslate nohighlight">
\[
E[g(x)] = \int{\frac{f(x)}{p(x)} \, p(x) \, dx} = \int{f(x) dx} = I
\]</div>
<p>By the law of large numbers, the average converges on the expectation, so we have</p>
<div class="math notranslate nohighlight">
\[
I \approx \bar{g_n} = \frac{1}{n} \sum_{i=1}^n g(x_i)
\]</div>
<p>Where random points <span class="math notranslate nohighlight">\(x_i\)</span> are generated from the distribution <span class="math notranslate nohighlight">\(p(x)\)</span>. If <span class="math notranslate nohighlight">\(f(x)\)</span> is a proper integral (i.e. bounded), and <span class="math notranslate nohighlight">\(p(x)\)</span> is the uniform distribution on <span class="math notranslate nohighlight">\([0,1]\)</span>, then <span class="math notranslate nohighlight">\(g(x) = f(x)\)</span> and this is known as ordinary Monte Carlo. If the integral of <span class="math notranslate nohighlight">\(f(x)\)</span> is improper, then we need to use another distribution with the same support as <span class="math notranslate nohighlight">\(f(x)\)</span>.</p>
</div>
<div class="section" id="using-monte-carlo-evaluation-of-a-definite-integral">
<h3><span class="section-number">3.3.4. </span>Using Monte Carlo: evaluation of a definite integral<a class="headerlink" href="#using-monte-carlo-evaluation-of-a-definite-integral" title="Permalink to this headline">¶</a></h3>
<p>We want to estimate the following integral <span class="math notranslate nohighlight">\(I=\int_0^1 e^x dx\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gold&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="p">)])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$e^</span><span class="si">{x}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;$e^{x}$&#39;)
</pre></div>
</div>
<img alt="../_images/03_MC_17_1.png" src="../_images/03_MC_17_1.png" />
</div>
</div>
<p>We can evaluate via quadrature as told in calculus:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span>

<span class="n">y</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exact result:&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> 


<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="mi">10</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">]):</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">gn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;N of samples: </span><span class="si">%10d</span><span class="s1"> </span><span class="si">%.6f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">gn</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Exact result: 1.7182818284590453 1.9076760487502457e-14
N of samples:         10 1.824382
N of samples:        100 1.668157
N of samples:       1000 1.722563
N of samples:      10000 1.710476
N of samples:     100000 1.719191
N of samples:    1000000 1.718583
N of samples:   10000000 1.718215
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>N of samples:  100000000 1.718379
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="intuition-for-error-rate-why-monte-carlo-can-beat-brute-force-integration">
<h3><span class="section-number">3.3.5. </span>Intuition for error rate: Why Monte Carlo can beat brute force integration.<a class="headerlink" href="#intuition-for-error-rate-why-monte-carlo-can-beat-brute-force-integration" title="Permalink to this headline">¶</a></h3>
<p>Consider summing over many such IID (independent identically distributed) points:</p>
<div class="math notranslate nohighlight">
\[S_n = f(x_1) + f(x_2) + ... + f(x_n)\]</div>
<p>The sample mean is an approximation to the integral we are hoping to estimate via MC sampling <span class="math notranslate nohighlight">\(I \approx S_n/n\)</span></p>
<p>Using Chebyshev’s inequality we can see how fast the sample eman converges to true value wiht the number of samples:</p>
<div class="math notranslate nohighlight">
\[ P \left( \left| \frac{S_n}{n} - I \right| \ge \epsilon \right) \le \frac{V(S_1)}{\epsilon^2 N} =\delta\]</div>
<p>Where <span class="math notranslate nohighlight">\(\delta\)</span> quantifies simulation error frequency and <span class="math notranslate nohighlight">\(\epsilon\)</span> accuracy of the desired result.</p>
<p>Suppose we want 1% accuracy and 99% confidence - i.e. set <span class="math notranslate nohighlight">\(\epsilon =\delta =  0.01\)</span>. The above inequality tells us that we can achieve this with just <span class="math notranslate nohighlight">\(N = 1/(\delta \epsilon^2) = 1,000,000\)</span> samples, regardless of the data dimensionality.</p>
</div>
<div class="section" id="example-3-of-using-monte-carlo-monitoring-the-convergence-decresase-of-variance">
<h3><span class="section-number">3.3.6. </span>Example-3 of using Monte Carlo: monitoring the convergence (decresase of variance)<a class="headerlink" href="#example-3-of-using-monte-carlo-monitoring-the-convergence-decresase-of-variance" title="Permalink to this headline">¶</a></h3>
<p>We are often interested in knowing how many iterations it takes for Monte Carlo integration to “converge”. To do this, we would like some estimate of the variance, and it is useful to inspect such plots. One simple way to get confidence intervals for the plot of Monte Carlo estimate against number of iterations is simply to do many such simulations.</p>
<p>For the example, we will try to estimate the function (again)</p>
<div class="math notranslate nohighlight">
\[
f(x) = x \cos 71 x + \sin 13x, \ \  0 \le x \le 1
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">71</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">13</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$f(x)$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;$f(x)$&#39;)
</pre></div>
</div>
<img alt="../_images/03_MC_22_1.png" src="../_images/03_MC_22_1.png" />
</div>
</div>
<p>When we do a single run of MC we use one long sequence of unform random numbers</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># sequence of n uniform random numbers</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">100</span> 
<span class="n">x</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.05209615540588076
</pre></div>
</div>
</div>
</div>
<p>We vary the sample size from 1 to 100 and calculate the value of <span class="math notranslate nohighlight">\(y = \sum{x}/n\)</span> for 1000 replicates. We then plot the 2.5th and 97.5th percentile of the 1000 values of <span class="math notranslate nohighlight">\(y\)</span> to see how the variation in <span class="math notranslate nohighlight">\(y\)</span> changes with sample size. The blue lines indicate the 2.5th and 97.5th percentiles, and the red line a sample path.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">reps</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">reps</span><span class="p">)))</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">upper</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">[</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">upper</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">lower</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of independent MC runs&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 0, &#39;Number of independent MC runs&#39;)
</pre></div>
</div>
<img alt="../_images/03_MC_26_1.png" src="../_images/03_MC_26_1.png" />
</div>
</div>
</div>
<div class="section" id="on-variance-reduction">
<h3><span class="section-number">3.3.7. </span>On variance Reduction<a class="headerlink" href="#on-variance-reduction" title="Permalink to this headline">¶</a></h3>
<p>With independent samples <span class="math notranslate nohighlight">\(y_i = f(x_i)/p(x_i)\)</span> the variance of the Monte Carlo estimate is</p>
<div class="math notranslate nohighlight">
\[
\text{Var}[\bar{g_n}] = \text{Var} \left[ \frac{1}{n} \sum_i y_i \right ]= \frac{1}{n^2} \sum_{i=1}^{n} \text{Var}[y_i] = \frac{1}{n} \text{Var}[y_i]
\]</div>
<p>The objective is to make <span class="math notranslate nohighlight">\(\text{Var}[\bar{g_n}]\sim n^{-1}\)</span> as small as possible for the same number of samples <span class="math notranslate nohighlight">\(n\)</span>.</p>
<p>There are several variance reduction techniques (also colorfully known as Monte Carlo swindles). We will illustrate one such powerful tecnique called the importance sampling technique.</p>
</div>
<div class="section" id="importance-sampling">
<h3><span class="section-number">3.3.8. </span>Importance sampling<a class="headerlink" href="#importance-sampling" title="Permalink to this headline">¶</a></h3>
<p>Suppose we want to evaluate</p>
<div class="math notranslate nohighlight">
\[
I = \int{h(x)\,p(x) \, dx}
\]</div>
<p>where <span class="math notranslate nohighlight">\(h(x)\)</span> is some function and <span class="math notranslate nohighlight">\(p(x)\)</span> is the PDF of <span class="math notranslate nohighlight">\(x\)</span>. If it is hard to sample directly from <span class="math notranslate nohighlight">\(p\)</span>, we can introduce a new density function  <span class="math notranslate nohighlight">\(q(x)\)</span> that is easy to sample from, and write</p>
<div class="math notranslate nohighlight">
\[
I = \int{h(x)\, p(x)\, dx} = \int{h(x)\, \frac{p(x)}{q(x)} \, q(x) \, dx}
\]</div>
<p>In other words, we sample from <span class="math notranslate nohighlight">\(h(y)\)</span> where <span class="math notranslate nohighlight">\(y \sim q\)</span> and weight it by the likelihood ratio <span class="math notranslate nohighlight">\(\frac{p(y)}{q(y)}\)</span>, estimating the integral as</p>
<div class="math notranslate nohighlight">
\[
I \approx \frac{1}{n}\sum_{i=1}^n \frac{p(y_i)}{q(y_i)} h(y_i)
\]</div>
<p>Sometimes, even if we can sample from <span class="math notranslate nohighlight">\(p\)</span> directly, it is more efficient to use another distribution.</p>
</div>
<div class="section" id="example-of-importance-sampling">
<h3><span class="section-number">3.3.9. </span>Example of importance sampling<a class="headerlink" href="#example-of-importance-sampling" title="Permalink to this headline">¶</a></h3>
<p>Suppose we want to estimate the tail probability of <span class="math notranslate nohighlight">\(\mathcal{N}(0, 1)\)</span> for <span class="math notranslate nohighlight">\(P(X \gt 5)\)</span>. Regular MC integration using samples from <span class="math notranslate nohighlight">\(\mathcal{N}(0, 1)\)</span> is hopeless since nearly all samples will be rejected. However, we can use the exponential density truncated at 5 as the importance function and use importance sampling. Note that <span class="math notranslate nohighlight">\(h\)</span> here is simply the identify function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sci</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">expon</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sci</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f86af48f390&gt;]
</pre></div>
</div>
<img alt="../_images/03_MC_30_1.png" src="../_images/03_MC_30_1.png" />
</div>
</div>
<p>We expect about 3 draws out of 10,000,000 from <span class="math notranslate nohighlight">\(\mathcal{N}(0, 1)\)</span> to have a value greater than 5. Hence simply sampling from <span class="math notranslate nohighlight">\(\mathcal{N}(0, 1)\)</span> is hopelessly inefficient for Monte Carlo integration.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">v_true</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">sci</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">v_true</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.866515719235352e-07
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># using direct sampling with p(x)=N(0,1)</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">sci</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">v_mc</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span>

<span class="c1"># estimate and relative error</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Direct MC &amp; error:&#39;</span><span class="p">,</span> <span class="n">v_mc</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">v_mc</span> <span class="o">-</span> <span class="n">v_true</span><span class="p">)</span><span class="o">/</span><span class="n">v_true</span><span class="p">)</span>

<span class="c1"># using importance sampling with p(x)=exp(x)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">sci</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">expon</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">v_is</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sci</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="n">sci</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">expon</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>

<span class="c1"># estimate and relative error</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Direct IS MC &amp; error:&#39;</span><span class="p">,</span><span class="n">v_is</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">v_is</span><span class="o">-</span> <span class="n">v_true</span><span class="p">)</span><span class="o">/</span><span class="n">v_true</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Direct MC &amp; error: 0.0 1.0
Direct IS MC &amp; error: 2.8362799815479177e-07 0.010547905767458888
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="markov-chains">
<h2><span class="section-number">3.4. </span>Markov Chains<a class="headerlink" href="#markov-chains" title="Permalink to this headline">¶</a></h2>
<p>Suppose we have the following transition table:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Location</p></th>
<th class="text-align:left head"><p>Ames</p></th>
<th class="text-align:left head"><p>Des Moines</p></th>
<th class="text-align:left head"><p>Ankeny</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>Ames</p></td>
<td class="text-align:left"><p>0.9</p></td>
<td class="text-align:left"><p>0.05</p></td>
<td class="text-align:left"><p>0.05</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Des Moines</p></td>
<td class="text-align:left"><p>0.1</p></td>
<td class="text-align:left"><p>0.8</p></td>
<td class="text-align:left"><p>0.1</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Ankeny</p></td>
<td class="text-align:left"><p>0.04</p></td>
<td class="text-align:left"><p>0.01</p></td>
<td class="text-align:left"><p>0.95</p></td>
</tr>
</tbody>
</table>
<p>This says that a resident of Ames this year has a 90% chance of stying in Ames and a 5% chance of relocating to Des Moines or Ankeny the following year. Note that the probabilities only depend on the current year. The transitions between states (Ames, Des Moines and Ankeny) are then said to be modeled by a Markov chain.</p>
<p>If all cities each started with 300,000 residents, what is the long run distribution assuming no immigration or emigration?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Construct Matrix</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">]</span>
<span class="p">])</span>

<span class="c1"># Specify the shape</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">300000</span><span class="p">,</span> <span class="mi">300000</span><span class="p">,</span> <span class="mi">300000</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[300000],
       [300000],
       [300000]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">.</span><span class="n">T</span><span class="nd">@A</span>  <span class="c1"># After one year</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[312000., 258000., 330000.]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">A</span> <span class="o">@</span> <span class="n">A</span> <span class="c1"># After two years</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[319800., 225300., 354900.]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">x</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">matrix_power</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>  <span class="c1"># Brute force solution by raising matrix into powers</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[300000.50469469, 100000.21203929, 499999.28326602]])
</pre></div>
</div>
</div>
</div>
<div class="section" id="eigenvector-solution">
<h3><span class="section-number">3.4.1. </span>Eigenvector solution<a class="headerlink" href="#eigenvector-solution" title="Permalink to this headline">¶</a></h3>
<p>At steady state, we have</p>
<div class="math notranslate nohighlight">
\[
p^T A = p^T
\]</div>
<p>Taking the transpose on both sides, we see that</p>
<div class="math notranslate nohighlight">
\[
A^Tp = p
\]</div>
<p>suggesting that the steady state probability vector is the normalized eigenvector of <span class="math notranslate nohighlight">\(A^T\)</span> with <span class="math notranslate nohighlight">\(\lambda = 1\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">E</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

<span class="n">E</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([1.        , 0.88520797, 0.76479203])
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="population-dynamics-as-a-markov-chain-simultion">
<h3><span class="section-number">3.4.2. </span>Population dynamics as a  markov chain simultion<a class="headerlink" href="#population-dynamics-as-a-markov-chain-simultion" title="Permalink to this headline">¶</a></h3>
<p>Consider a population that cannot comprise more than N=100 individuals, and define the birth and death rates:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># maximum population size</span>
<span class="n">a</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span> <span class="o">/</span> <span class="n">N</span>  <span class="c1"># birth rate</span>
<span class="n">b</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span> <span class="o">/</span> <span class="n">N</span>  <span class="c1"># death rate</span>
</pre></div>
</div>
</div>
</div>
<p>We simulate a Markov chain on the finite space <span class="math notranslate nohighlight">\(0,1,...,N.\)</span> Each state represents a population size. The x vector will contain the population size at each time step. We set the initial state to <span class="math notranslate nohighlight">\(x_0=25\)</span> (that is, there are 25 individuals in the population at initialization time):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nsteps</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsteps</span><span class="p">)</span>
<span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span>
</pre></div>
</div>
</div>
</div>
<p>Now we simulate our chain. At each time step t, there is a new birth with probability <span class="math notranslate nohighlight">\(ax_t\)</span>, and independently, there is a new death with probability <span class="math notranslate nohighlight">\(bx_t\)</span>. These <strong>probabilities are proportional to the size of the population</strong> at that time. If the population size reaches <span class="math notranslate nohighlight">\(0\)</span> or <span class="math notranslate nohighlight">\(N\)</span>, the evolution stops:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsteps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    
    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Is there a birth?</span>
        <span class="n">birth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="c1"># Is there a death?</span>
        <span class="n">death</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="c1"># We update the population size.</span>
        <span class="n">x</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">birth</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">death</span>
    <span class="c1"># The evolution stops if we reach $0$ or $N$.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f86af3d1490&gt;]
</pre></div>
</div>
<img alt="../_images/03_MC_47_1.png" src="../_images/03_MC_47_1.png" />
</div>
</div>
</div>
<div class="section" id="consider-many-independent-trials-now">
<h3><span class="section-number">3.4.3. </span>Consider many independent trials now.<a class="headerlink" href="#consider-many-independent-trials-now" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ntrials</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">ntrials</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>  <span class="c1">#Trying to avoid nested loops</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">simulate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run the simulation.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsteps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1"># Which trials to update?</span>
        <span class="n">upd</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># In which trials do births occur?</span>
        <span class="n">birth</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">ntrials</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
        <span class="c1"># In which trials do deaths occur?</span>
        <span class="n">death</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">ntrials</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
        <span class="c1"># We update the population size for all trials</span>
        <span class="n">x</span><span class="p">[</span><span class="n">upd</span><span class="p">]</span> <span class="o">+=</span> <span class="n">birth</span><span class="p">[</span><span class="n">upd</span><span class="p">]</span> <span class="o">-</span> <span class="n">death</span><span class="p">[</span><span class="n">upd</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">nsteps_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">nsteps_list</span><span class="p">),</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nsteps</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nsteps_list</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">simulate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Population size&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Histogram&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nsteps</span><span class="si">}</span><span class="s2"> time steps&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_MC_51_0.png" src="../_images/03_MC_51_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="problems">
<h2><span class="section-number">3.5. </span>Problems<a class="headerlink" href="#problems" title="Permalink to this headline">¶</a></h2>
<div class="section" id="problem-1-confined-diffusion">
<h3><span class="section-number">3.5.1. </span>Problem-1: Confined diffusion.<a class="headerlink" href="#problem-1-confined-diffusion" title="Permalink to this headline">¶</a></h3>
<p>Simulate 2D random walk in a circular confinement. Re-write 2D brownian motion code to simulate diffusion of a particle which is stuck inside a sphere.
Study how root mean square deviation of position scales with time. Carry out simulations for different coninement sizes. Make plots of simulated trajectories.</p>
</div>
<div class="section" id="problem-2-continuous-time-random-walk-ctrw">
<h3><span class="section-number">3.5.2. </span>Problem-2: continuous time random walk (CTRW)<a class="headerlink" href="#problem-2-continuous-time-random-walk-ctrw" title="Permalink to this headline">¶</a></h3>
<p>Simulate 1D random walk but instead of picking times at regular intervals pick them from  exponential distribution. <br>
Hint: you may want to use random variables from scipy.stats.exp <br></p>
<p><a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.expon.html">scipy.stats.expon</a> <br></p>
<p>Study the root mean square deviation as a function of exponential decay parameter <span class="math notranslate nohighlight">\(\lambda\)</span> of exponential distribution <span class="math notranslate nohighlight">\(e^{-\lambda x}\)</span>.</p>
</div>
<div class="section" id="problem-3-breaking-the-clt-cauchy-vs-normal-random-walk-in-2d">
<h3><span class="section-number">3.5.3. </span>Problem-3: Breaking the CLT; Cauchy vs Normal random walk in 2D<a class="headerlink" href="#problem-3-breaking-the-clt-cauchy-vs-normal-random-walk-in-2d" title="Permalink to this headline">¶</a></h3>
<p>For this problem we are going to simulate two kinds of random walks in continuum space (not lattice): Levy flights and Normal distributd random walk.</p>
<p>To simulate a 2D continuum space random walk we need to generate random step sizes <span class="math notranslate nohighlight">\(r_x\)</span>, <span class="math notranslate nohighlight">\(r_y\)</span>.
Also you will need unifrom random namber to sample angles in 2D giving you a conitnuum random walk in 2D space: <span class="math notranslate nohighlight">\(x = r_x sin\theta\)</span> and <span class="math notranslate nohighlight">\(y=r_ycos\theta\)</span></p>
<ul class="simple">
<li><p>Normally: <span class="math notranslate nohighlight">\(r\sim N(0,1)\)</span></p></li>
<li><p>Cauchy distribution (long tails, infinite variance) <span class="math notranslate nohighlight">\(r\sim Cauchy(0,1)\)</span></p></li>
<li><p>Unform angles <span class="math notranslate nohighlight">\(\theta \sim U(0,1)\)</span></p></li>
</ul>
<p>Visualize random walk using matplotlib and study statistics of random walkers the way that is done for normal random walk/brownian motion examples!</p>
</div>
<div class="section" id="problem-4-mc-the-crude-version">
<h3><span class="section-number">3.5.4. </span>Problem-4: MC, the crude version<a class="headerlink" href="#problem-4-mc-the-crude-version" title="Permalink to this headline">¶</a></h3>
<p>Evaluate the following integral <span class="math notranslate nohighlight">\(\int^{\infty}_0 \frac{e^{-x}}{1+(x-1)^2} dx\)</span> using Monte Carlo methods.</p>
<ul class="simple">
<li><p>Start by doing a direct monte carlo on uniform interval.</p></li>
<li><p>Try an importance sampling approach using en exponential probability distribution.</p></li>
<li><p>Find the optimal value of <span class="math notranslate nohighlight">\(\lambda \)</span> that gives the most rapid reduction of variance [Hint: experiment with different values of <span class="math notranslate nohighlight">\(\lambda\)</span>]</p></li>
</ul>
</div>
<div class="section" id="problem-5-mc-method-for-evaluating-1d-and-2d-integrals">
<h3><span class="section-number">3.5.5. </span>Problem-5 MC method for evaluating 1D and 2D integrals<a class="headerlink" href="#problem-5-mc-method-for-evaluating-1d-and-2d-integrals" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Since you got some experience doing MC integrations maybe you feel like generalizing your apporach a bit. Can you write a function called mc_int(f, x0, x1, N) which does monte carlo integration of simple well behaved functions f over interval x0 to x1 using N unifrom distributed random numbers on <span class="math notranslate nohighlight">\([x0, x1]\)</span>. You can also make do_mc() plot where the random points fell on the f(x) function in addition to returning the value of the evaluated integral.</p></li>
<li><p>Generalize your function to compute 2D integral mc_int(f, x0, x1, y0, y1 N). Test this function by computing simple rectangular shaped area functions, e.g <span class="math notranslate nohighlight">\(x_0=1, x_1 =3, y_0=1, y_1=5\)</span></p></li>
</ul>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./01_stats"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="02_RandVar.html" title="previous page"><span class="section-number">2. </span>Random variable, stochastic process and simulation.</a>
    <a class='right-next' id="next-link" href="04_LimitTheorems.html" title="next page"><span class="section-number">4. </span>Appendix B1: Probability distirbutions functions (PDFs) and Limit theorems</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Davit Potoyan<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>