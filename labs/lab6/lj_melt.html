

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Create Structure and Topology objects &#8212; Statistical Mechanics for Chemistry and Biology</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'labs/lab6/lj_melt';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Simulating Ethane" href="openmm_ethane.html" />
    <link rel="prev" title="Double Well potential using OpenMM" href="openmm_double_well.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.jpg" class="logo__image only-light" alt="Statistical Mechanics for Chemistry and Biology - Home"/>
    <script>document.write(`<img src="../../_static/logo.jpg" class="logo__image only-dark" alt="Statistical Mechanics for Chemistry and Biology - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    About
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Chapters</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../schedule.html">Schedule (Spring 2025)</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../1_stats/intro.html">Stats</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../1_stats/Probabilities_Counting.html">Probability theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../1_stats/Random_Variables.html">Random variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../1_stats/Diffusion.html">Diffusion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../1_stats/Entropy.html">Entropy and Information</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../2_thermo/intro.html">Thermodynamics</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../2_thermo/01_Thermo.html">Review of thermodynamics principles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2_thermo/02_FreeEnergies.html">Thermodynamic Potentials</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../3_ensembles/intro.html">Ensembles</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../3_ensembles/nve.html">Intro to Statistical Ensembles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../3_ensembles/nvt.html">Ensembles in phase-space</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../3_ensembles/npt.html">Open Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../3_ensembles/ensemble_overview.html">Summary of Ensembles</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../4_ising/intro.html">Phase transitions</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../4_ising/00_phase_tranistions.html">Phase transitions: a birds eye view</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../4_ising/01_MC.html">Monte Carlo and “the power of randomness”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../4_ising/02_MCMC.html">Ising models and Metropolis algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../4_ising/03_MF.html">Mean Field</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../5_fluids/intro.html">Fluids</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../5_fluids/Intro2Fluids.html">Statistical mechanics of fluids</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../5_fluids/Intro2MD.html">Molecular Dynamics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../5_fluids/md_lj.html">MD/MC simulations of fluids</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../py-lab/intro.html">Python</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../py-lab/intro2py.html">Python3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../py-lab/intro2numpy.html">NumPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../py-lab/intro2viz.html">Plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../py-lab/python_OOP_challenge.html">Tutorial: Building Python Classes</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../np-lab/intro.html">Numpy lab</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../np-lab/np_prob.html">Numpy and Probabilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../np-lab/sinc_function.html">Numpy Lab: Sinc Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../np-lab/linear_functions.html">Numpy Lab: Linear Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../np-lab/1d_gas_sim.html">Tutorial: Numpy simultions of 1D gas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../np-lab/2d_gas_sim.html">Tutorial: Numpy simultions of 2D gas</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../rw-lab/intro.html">Random Walks</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../rw-lab/rw_lab.html">Random walk simulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rw-lab/InverseTransform.html">The Inverse Transform of RVs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rw-lab/change_rv_jax.html">Change of variables with automatic differentiation (autodiff)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rw-lab/polymer-conf.html">Conformations of Random Polymer Chains</a></li>

<li class="toctree-l2"><a class="reference internal" href="../rw-lab/langevin.html">Langevin Equation for Brownian Motion and Mean Square Displacement (MSD)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../lab4/intro.html">Application of ensembles</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../lab4/nvt_application.html">Free energy and protein folding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lab4/TwoState.html">Two-state system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lab4/mass_action.html">Mass action law</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../lab5/intro.html">Simulating Ising models</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../lab5/markov_chains.html">Markov Chains</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lab5/Wolf.html">Other Methods for sampling Ising models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lab5/enhance-sampling.html">Non-boltzman (enhanced) sampling ideas</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="intro.html">Simulating Fluids</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="openmm_harm_osc.html">Molecular dynamics simulations with OpenMM</a></li>
<li class="toctree-l2"><a class="reference internal" href="openmm_double_well.html">Double Well potential using OpenMM</a></li>

<li class="toctree-l2 current active"><a class="current reference internal" href="#">Create Structure and Topology objects</a></li>


<li class="toctree-l2"><a class="reference internal" href="openmm_ethane.html">Simulating Ethane</a></li>
<li class="toctree-l2"><a class="reference internal" href="water_box_sim.html">TIP3P/TIP4P Water Model Simulation in OpenMM</a></li>
<li class="toctree-l2"><a class="reference internal" href="alanine_dipeptide.html">Simulating Alanine dipeptide</a></li>
<li class="toctree-l2"><a class="reference internal" href="openmm_villin.html">Simulating solvated protein</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../finals/intro.html">Final Projects</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../finals/glauber.html"><strong>Final Project: Simulating Ising Spin Relaxation with Glauber Dynamics</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../finals/nucleation.html">Final Project: Metastability and Nucleation in the 2D Ising Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../finals/tst.html">Final Project: Simulating Chemical Reactions with Langevin Dynamics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../finals/lj_ab_monomer.html"><strong>Final Project: Phase Separation in Binary Lennard-Jones Mixtures</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../finals/lj_ab_polymer.html">Final Project: Sequence-Dependent Structure in Lennard-Jones Polymers Using OpenMM</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/DPotoyan/Statmech4ChemBio/master?urlpath=lab/tree/labs/lab6/lj_melt.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/DPotoyan/Statmech4ChemBio/blob/master/labs/lab6/lj_melt.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/labs/lab6/lj_melt.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Create Structure and Topology objects</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Create Structure and Topology objects</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-the-force-field">Defining the force field</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#option-1-defining-a-force-field-using-the-python-api">Option-1: Defining a force-field using the Python API</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#option-2-creating-a-force-field-xml-file">Option-2” Creating a force-field xml file</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-the-system">Create the system</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-and-run-the-simulation">Setup and run the simulation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-simulation">Visualize Simulation</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>-q<span class="w"> </span>condacolab
<span class="kn">import</span><span class="w"> </span><span class="nn">condacolab</span>
<span class="n">condacolab</span><span class="o">.</span><span class="n">install</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">hostedtoolcache</span><span class="o">/</span><span class="n">Python</span><span class="o">/</span><span class="mf">3.8.18</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">condacolab</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">26</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">26</span>     <span class="kn">import</span><span class="w"> </span><span class="nn">google.colab</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span> <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;google&#39;

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">RuntimeError</span><span class="g g-Whitespace">                              </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;pip install -q condacolab&#39;</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="kn">import</span><span class="w"> </span><span class="nn">condacolab</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">condacolab</span><span class="o">.</span><span class="n">install</span><span class="p">()</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">hostedtoolcache</span><span class="o">/</span><span class="n">Python</span><span class="o">/</span><span class="mf">3.8.18</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">condacolab</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">28</span>
<span class="g g-Whitespace">     </span><span class="mi">26</span>     <span class="kn">import</span><span class="w"> </span><span class="nn">google.colab</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span> <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">28</span>     <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;This module must ONLY run as part of a Colab notebook!&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">31</span> <span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.1.6&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span> <span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Jaime Rodríguez-Guerra &lt;jaimergp@users.noreply.github.com&gt;&quot;</span>

<span class="ne">RuntimeError</span>: This module must ONLY run as part of a Colab notebook!
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%capture
!conda install -c conda-forge openmm mdtraj parmed
!pip install py3dmol 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">openmm</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mm</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">openmm.app</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">app</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">openmm.unit</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">unit</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sys</span><span class="w"> </span><span class="kn">import</span> <span class="n">stdout</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">parmed</span><span class="w"> </span><span class="kn">import</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">Atom</span><span class="p">,</span> <span class="n">Bond</span>
</pre></div>
</div>
</div>
</div>
<section id="create-structure-and-topology-objects">
<h1>Create Structure and Topology objects<a class="headerlink" href="#create-structure-and-topology-objects" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># System parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mi">100</span>   <span class="c1"># Number of chains</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>    <span class="c1"># Atoms per chain</span>
<span class="n">mass</span> <span class="o">=</span> <span class="mf">120.0</span>  <span class="c1"># Mass in amu</span>

<span class="c1"># Create an empty structure</span>
<span class="n">structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">()</span>

<span class="c1"># Add atoms and residues</span>
<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">atom</span> <span class="o">=</span> <span class="n">Atom</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;CG&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;CG&#39;</span><span class="p">,</span> <span class="n">atomic_number</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="n">mass</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">resname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;CG</span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">resnum</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">structure</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="n">atom</span><span class="p">,</span> <span class="n">resname</span><span class="o">=</span><span class="n">resname</span><span class="p">,</span> <span class="n">resnum</span><span class="o">=</span><span class="n">resnum</span><span class="p">,</span> <span class="n">chain</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">)</span>

<span class="c1"># Assign simple positions: spaced along z-axis</span>
<span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">):</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(((</span><span class="n">m</span><span class="o">%</span><span class="k">10</span>)*1.0, (m//10)*1.0, 0))
    <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
        <span class="n">xi</span> <span class="o">=</span> <span class="n">positions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">))</span>
        <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>

<span class="c1"># Convert the list into OpenMM Quantity with units of nm</span>
<span class="n">structure</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="n">positions</span> <span class="o">*</span> <span class="n">unit</span><span class="o">.</span><span class="n">nanometer</span>

<span class="c1"># Add bonds between consecutive atoms in each chain</span>
<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">):</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="n">N</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">n</span>
        <span class="n">structure</span><span class="o">.</span><span class="n">bonds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bond</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">structure</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>

<span class="c1"># Save the files</span>
<span class="n">structure</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;cg_polymer.pdb&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">structure</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;cg_polymer.psf&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check basic info</span>
<span class="nb">print</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">topology</span><span class="p">)</span>
<span class="n">structure</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Topology; 1 chains, 100 residues, 1000 atoms, 900 bonds&gt;
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>number</th>
      <th>name</th>
      <th>type</th>
      <th>atomic_number</th>
      <th>charge</th>
      <th>mass</th>
      <th>nb_idx</th>
      <th>solvent_radius</th>
      <th>screen</th>
      <th>occupancy</th>
      <th>...</th>
      <th>rmin_14</th>
      <th>epsilon_14</th>
      <th>resname</th>
      <th>resid</th>
      <th>resnum</th>
      <th>chain</th>
      <th>segid</th>
      <th>xx</th>
      <th>xy</th>
      <th>xz</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-1</td>
      <td>CG</td>
      <td>CG</td>
      <td>0</td>
      <td>0.0</td>
      <td>120.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>CG0</td>
      <td>0</td>
      <td>1</td>
      <td>A</td>
      <td></td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-1</td>
      <td>CG</td>
      <td>CG</td>
      <td>0</td>
      <td>0.0</td>
      <td>120.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>CG0</td>
      <td>0</td>
      <td>1</td>
      <td>A</td>
      <td></td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.8</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-1</td>
      <td>CG</td>
      <td>CG</td>
      <td>0</td>
      <td>0.0</td>
      <td>120.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>CG0</td>
      <td>0</td>
      <td>1</td>
      <td>A</td>
      <td></td>
      <td>0.0</td>
      <td>0.0</td>
      <td>7.6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-1</td>
      <td>CG</td>
      <td>CG</td>
      <td>0</td>
      <td>0.0</td>
      <td>120.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>CG0</td>
      <td>0</td>
      <td>1</td>
      <td>A</td>
      <td></td>
      <td>0.0</td>
      <td>0.0</td>
      <td>11.4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-1</td>
      <td>CG</td>
      <td>CG</td>
      <td>0</td>
      <td>0.0</td>
      <td>120.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>CG0</td>
      <td>0</td>
      <td>1</td>
      <td>A</td>
      <td></td>
      <td>0.0</td>
      <td>0.0</td>
      <td>15.2</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 27 columns</p>
</div></div></div>
</div>
</section>
<section id="defining-the-force-field">
<h1>Defining the force field<a class="headerlink" href="#defining-the-force-field" title="Permalink to this heading">#</a></h1>
<p>We will cover two methods for defining the forcefield:</p>
<ol class="arabic simple">
<li><p>Using the Python API.</p></li>
<li><p>Creating a forcefield xml file.</p></li>
</ol>
<p>Both methods achieve the same result of defining the forcefield. There are pros and cons of both ways. The key points are that using the Python API is more flexible, while creating a forcefield xml file makes it easier to share your forcefield and helps reproducibility. This is demonstrated in the other OpenMM tutorials — the standard forcefields such as Amber are distributed with OpenMM as xml files, while the custom forces used to do free energy calculations are defined using the Python API.</p>
<section id="option-1-defining-a-force-field-using-the-python-api">
<h2>Option-1: Defining a force-field using the Python API<a class="headerlink" href="#option-1-defining-a-force-field-using-the-python-api" title="Permalink to this heading">#</a></h2>
<p>We can create instances of the OpenMM <a class="reference external" href="http://docs.openmm.org/latest/api-python/library.html#forces">Force classes</a>, assign parameters, and add them to the system.
First we must create a <a class="reference external" href="http://docs.openmm.org/latest/api-python/generated/openmm.openmm.System.html#openmm.openmm.System">System</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create the system and add the particles to it</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">System</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">atoms</span><span class="p">)):</span>
  <span class="n">system</span><span class="o">.</span><span class="n">addParticle</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">mass</span><span class="p">)</span>

<span class="n">box_vecs</span> <span class="o">=</span> <span class="mi">11</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">nanometer</span>
<span class="n">system</span><span class="o">.</span><span class="n">setDefaultPeriodicBoxVectors</span><span class="p">(</span><span class="o">*</span><span class="n">box_vecs</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">harmonic_bond_force</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">HarmonicBondForce</span><span class="p">()</span>

<span class="c1"># Add each bond to the force from the topology</span>
<span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">bonds</span><span class="p">():</span>
    <span class="n">harmonic_bond_force</span><span class="o">.</span><span class="n">addBond</span><span class="p">(</span><span class="n">bond</span><span class="o">.</span><span class="n">atom1</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">bond</span><span class="o">.</span><span class="n">atom2</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="c1"># Define a Lennard-Jones potential</span>
<span class="n">expression</span> <span class="o">=</span> <span class="s1">&#39;4*epsilon*((sigma/r)^12-(sigma/r)^6);&#39;</span>\
            <span class="o">+</span> <span class="s1">&#39; sigma=0.5*(sigma1+sigma2);&#39;</span>\
            <span class="o">+</span> <span class="s1">&#39; epsilon=sqrt(epsilon1*epsilon2)&#39;</span>

<span class="n">custom_nb_force</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">CustomNonbondedForce</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>

<span class="n">custom_nb_force</span><span class="o">.</span><span class="n">addPerParticleParameter</span><span class="p">(</span><span class="s1">&#39;sigma&#39;</span><span class="p">)</span>
<span class="n">custom_nb_force</span><span class="o">.</span><span class="n">addPerParticleParameter</span><span class="p">(</span><span class="s1">&#39;epsilon&#39;</span><span class="p">)</span>

<span class="c1"># Add the parameters for each particle</span>
<span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">atoms</span><span class="p">():</span>
    <span class="n">custom_nb_force</span><span class="o">.</span><span class="n">addParticle</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>

<span class="c1"># Create exclusions for directly bonded atoms</span>
<span class="n">custom_nb_force</span><span class="o">.</span><span class="n">createExclusionsFromBonds</span><span class="p">([(</span><span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">bonds</span><span class="p">()],</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Set a cutoff of 1.5nm</span>
<span class="n">custom_nb_force</span><span class="o">.</span><span class="n">setNonbondedMethod</span><span class="p">(</span><span class="n">mm</span><span class="o">.</span><span class="n">CustomNonbondedForce</span><span class="o">.</span><span class="n">CutoffPeriodic</span><span class="p">)</span>
<span class="n">custom_nb_force</span><span class="o">.</span><span class="n">setCutoffDistance</span><span class="p">(</span><span class="mf">1.5</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">nanometers</span><span class="p">)</span>

<span class="c1"># Add the forces to the system</span>
<span class="n">system</span><span class="o">.</span><span class="n">addForce</span><span class="p">(</span><span class="n">harmonic_bond_force</span><span class="p">)</span>
<span class="n">system</span><span class="o">.</span><span class="n">addForce</span><span class="p">(</span><span class="n">custom_nb_force</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
</pre></div>
</div>
</div>
</div>
</section>
<section id="option-2-creating-a-force-field-xml-file">
<h2>Option-2” Creating a force-field xml file<a class="headerlink" href="#option-2-creating-a-force-field-xml-file" title="Permalink to this heading">#</a></h2>
<p>Alternatively, we can create a custom force-field xml file for our system. You should look here first for the full information: <a class="reference external" href="http://docs.openmm.org/latest/userguide/application/05_creating_ffs.html">http://docs.openmm.org/latest/userguide/application/05_creating_ffs.html</a>.</p>
<p>You will need to create a new file called “cg_ff.xml” using a text editor of your choice. Then paste the following lines into it:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- cg_ff.xml </span>
<span class="cm">Coarse-grained forcefield for a bead-spring polymer. --&gt;</span>
<span class="nt">&lt;ForceField&gt;</span>
<span class="w">	</span>
<span class="w">    </span><span class="nt">&lt;AtomTypes&gt;</span>
<span class="w">	    </span><span class="nt">&lt;Type</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;CG-bead&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;CG-bead&quot;</span><span class="w"> </span><span class="na">element=</span><span class="s">&quot;CG&quot;</span><span class="w"> </span><span class="na">mass=</span><span class="s">&quot;120.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">	</span><span class="nt">&lt;/AtomTypes&gt;</span>

<span class="w">	</span><span class="nt">&lt;Residues&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- Each bead is a single residue.</span>
<span class="cm">        Need a template for the different Residue types. </span>
<span class="cm">        First type is the end. This only has one bond. --&gt;</span>
<span class="w">        </span><span class="nt">&lt;Residue</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;CG-residue-end&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;Atom</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;CG-bead&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;CG-bead&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;ExternalBond</span><span class="w"> </span><span class="na">atomName=</span><span class="s">&quot;CG-bead&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/Residue&gt;</span>

<span class="w">        </span><span class="cm">&lt;!-- Second type is in the middle of the chain. This has two bonds. --&gt;</span>
<span class="w">        </span><span class="nt">&lt;Residue</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;CG-residue-middle&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;Atom</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;CG-bead&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;CG-bead&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;ExternalBond</span><span class="w"> </span><span class="na">atomName=</span><span class="s">&quot;CG-bead&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;ExternalBond</span><span class="w"> </span><span class="na">atomName=</span><span class="s">&quot;CG-bead&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/Residue&gt;</span>
<span class="w">    </span><span class="nt">&lt;/Residues&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- Define a harmonic bond between the CA-beads --&gt;</span>
<span class="w">    </span><span class="nt">&lt;HarmonicBondForce&gt;</span>
<span class="w">        </span><span class="nt">&lt;Bond</span><span class="w"> </span><span class="na">class1=</span><span class="s">&quot;CG-bead&quot;</span><span class="w"> </span><span class="na">class2=</span><span class="s">&quot;CG-bead&quot;</span><span class="w"> </span><span class="na">length=</span><span class="s">&quot;0.38&quot;</span><span class="w"> </span><span class="na">k=</span><span class="s">&quot;1000.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/HarmonicBondForce&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- Use a custom non-bonded force for maximum flexibility.</span>
<span class="cm">    The bondCutoff=1 tells it to only exclude interactions between directly bonded atoms. --&gt;</span>
<span class="w">    </span><span class="nt">&lt;CustomNonbondedForce</span><span class="w"> </span><span class="na">energy=</span><span class="s">&quot;4*epsilon*((sigma/r)^12-(sigma/r)^6); sigma=0.5*(sigma1+sigma2); epsilon=sqrt(epsilon1*epsilon2)&quot;</span><span class="w"> </span><span class="na">bondCutoff=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;PerParticleParameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;sigma&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;PerParticleParameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;epsilon&quot;</span><span class="nt">/&gt;</span>
<span class="w">		</span><span class="nt">&lt;Atom</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;CG-bead&quot;</span><span class="w"> </span><span class="na">sigma=</span><span class="s">&quot;0.5&quot;</span><span class="w"> </span><span class="na">epsilon=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">	</span><span class="nt">&lt;/CustomNonbondedForce&gt;</span>
<span class="nt">&lt;/ForceField&gt;</span>
</pre></div>
</div>
<p>(If you have cloned the cookbook repo then this file will already exist)
The comments in the above code explain what the difference sections are for.</p>
</section>
<section id="create-the-system">
<h2>Create the system<a class="headerlink" href="#create-the-system" title="Permalink to this heading">#</a></h2>
<p>We can now load in our previously created custom <code class="docutils literal notranslate"><span class="pre">ForceField</span></code> and use the <code class="docutils literal notranslate"><span class="pre">createSystem</span></code> method with the <code class="docutils literal notranslate"><span class="pre">topology</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load in the ForceField we created</span>
<span class="n">ff</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">ForceField</span><span class="p">(</span><span class="s1">&#39;cg_ff.xml&#39;</span><span class="p">)</span>
<span class="n">system2</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">createSystem</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">nonbondedMethod</span><span class="o">=</span><span class="n">app</span><span class="o">.</span><span class="n">CutoffPeriodic</span><span class="p">,</span> <span class="n">nonbondedCutoff</span><span class="o">=</span><span class="mf">1.5</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">nanometers</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can compare the two systems to check if they are the same. A simple way to do this is to serialize the systems as save them as xml files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;system1.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mm</span><span class="o">.</span><span class="n">XmlSerializer</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">system</span><span class="p">))</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;system2.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mm</span><span class="o">.</span><span class="n">XmlSerializer</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">system2</span><span class="p">))</span>

<span class="o">!</span>diff<span class="w"> </span>system1.xml<span class="w"> </span>system2.xml
</pre></div>
</div>
</div>
</div>
<p>We actually find they are slightly different. <code class="docutils literal notranslate"><span class="pre">system2</span></code> created by <code class="docutils literal notranslate"><span class="pre">ForceField.createSystem</span></code> has a <code class="docutils literal notranslate"><span class="pre">CMMotionRemover</span></code> that was added by default when using the <code class="docutils literal notranslate"><span class="pre">createSystem</span></code> method. If we wanted to we could add this to the first system.</p>
</section>
</section>
<section id="setup-and-run-the-simulation">
<h1>Setup and run the simulation<a class="headerlink" href="#setup-and-run-the-simulation" title="Permalink to this heading">#</a></h1>
<p>We will use a <code class="docutils literal notranslate"><span class="pre">LangevinMiddleIntegrator</span></code> with a friction term of 0.01ps^-1 and a timestep of 0.01ps as used in similar coarse-grained polymer models [1]. For your own models these parameters will be important and you will need to choose them carefully!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">integrator</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">LangevinMiddleIntegrator</span><span class="p">(</span><span class="mi">300</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">kelvin</span><span class="p">,</span> <span class="mf">0.01</span><span class="o">/</span><span class="n">unit</span><span class="o">.</span><span class="n">picosecond</span><span class="p">,</span> <span class="mf">0.010</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">picoseconds</span><span class="p">)</span>
<span class="n">simulation</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">topology</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">integrator</span><span class="p">)</span>
<span class="n">simulation</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">setPositions</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>

<span class="c1"># setup simulation reporters</span>
<span class="c1"># Write the trajectory to a file called &#39;traj.dcd&#39;</span>
<span class="n">simulation</span><span class="o">.</span><span class="n">reporters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">DCDReporter</span><span class="p">(</span><span class="s1">&#39;traj.dcd&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">enforcePeriodicBox</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

<span class="c1"># Report information to the screen as the simulation runs</span>
<span class="n">simulation</span><span class="o">.</span><span class="n">reporters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">StateDataReporter</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">potentialEnergy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">volume</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>


<span class="c1"># NVT equilibration</span>
<span class="n">simulation</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>

<span class="c1"># Add a barostat</span>
<span class="n">barostatIndex</span><span class="o">=</span><span class="n">system</span><span class="o">.</span><span class="n">addForce</span><span class="p">(</span><span class="n">mm</span><span class="o">.</span><span class="n">MonteCarloBarostat</span><span class="p">(</span><span class="mf">1.0</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">bar</span><span class="p">,</span> <span class="mi">300</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">kelvin</span><span class="p">))</span>
<span class="n">simulation</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">reinitialize</span><span class="p">(</span><span class="n">preserveState</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Run NPT equilibration</span>
<span class="n">simulation</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>#&quot;Step&quot;,&quot;Potential Energy (kJ/mole)&quot;,&quot;Temperature (K)&quot;,&quot;Box Volume (nm^3)&quot;,&quot;Speed (ns/day)&quot;
1000,-2504.836181640625,191.5762888669726,1331.0,0
2000,-2815.38623046875,228.05667202079903,1331.0,1e+03
3000,-2720.246337890625,237.99379315778745,1331.0,968
4000,-2717.5224609375,246.43023451709598,1331.0,942
5000,-2659.786865234375,253.65382630735783,1331.0,900
6000,-2649.3740234375,262.1551793714623,1331.0,877
7000,-2439.745361328125,257.93077347642696,1331.0,879
8000,-2385.37646484375,261.5250756318168,1331.0,894
9000,-2507.65869140625,277.1601449505948,1331.0,894
10000,-2277.37890625,263.72359415211446,1331.0,888
11000,-2352.224853515625,277.5869879541712,1224.1066608916633,881
12000,-2151.421875,272.3363540797704,1217.1759308796754,850
13000,-2169.27490234375,274.05078020934116,1126.4046429984535,849
14000,-2102.018310546875,272.95167374749195,1059.0785394736092,831
15000,-2159.517578125,280.71576208676345,1019.7380219560032,810
16000,-2180.33447265625,283.8484832712969,916.285214431259,796
17000,-2051.6181640625,272.3146143999463,904.4493001807455,781
18000,-2094.2294921875,284.0290534109619,899.8734092637802,770
19000,-2165.8671875,283.0528967485372,851.9844830974769,760
20000,-2205.318115234375,281.1227509728958,819.3514649819555,750
21000,-2240.06640625,277.7291262216464,744.7108329580016,743
22000,-2270.175048828125,289.7231251012086,690.54029952904,735
23000,-2166.90283203125,288.02704420530813,714.4953652595874,730
24000,-2042.0665283203125,282.2783723471896,657.17060647423,724
25000,-2157.97265625,289.81985838884697,568.0055136847603,726
26000,-2064.509033203125,279.2794794212596,528.1222343854555,720
27000,-2097.9609375,278.8585177835825,476.022732738361,715
28000,-2136.488525390625,285.4858725279452,454.2461928375308,717
29000,-2275.820068359375,297.4297078624183,411.57515560451657,717
30000,-2302.36328125,296.8539829212256,382.9434600057386,713
31000,-2322.546630859375,293.28292644135826,351.7996888497053,708
32000,-2323.501708984375,301.54835140926133,326.3492824758923,708
33000,-2344.83203125,296.83241114510923,305.0296352469343,704
34000,-2371.13818359375,292.0429706275744,272.28412890464665,700
35000,-2395.903564453125,299.9779724446933,255.96621936747422,697
36000,-2426.533203125,300.50611639627925,245.95579266983378,694
37000,-2463.66845703125,301.7052921624469,231.4306650768564,690
38000,-2523.1689453125,303.3020174178514,222.77053028028178,687
39000,-2468.69091796875,305.6769871541834,215.18216250964574,683
40000,-2439.684814453125,296.2453221377333,202.64792525833616,683
41000,-2619.2255859375,304.21391337578046,182.74158676803813,684
42000,-2653.97216796875,303.5549828120358,170.45828251946833,682
43000,-2828.11474609375,322.2711930312677,164.31983469702786,683
44000,-2836.41455078125,313.82151050042694,162.49357145363723,681
45000,-2784.0439453125,317.83260171624175,161.80449110324318,679
46000,-2966.98291015625,326.5362778178724,154.9536375508575,680
47000,-2886.562744140625,317.998989801577,155.0226264149907,682
48000,-3015.0478515625,311.83503874485706,157.29521573680645,683
49000,-3177.96435546875,321.1500196360962,155.53068279557974,684
50000,-3078.247802734375,304.8727344661126,153.33806897954847,684
51000,-3134.77392578125,316.3601262254108,154.3395998209216,683
52000,-3081.000732421875,310.44632688484296,155.36769816752778,684
53000,-3122.693359375,302.79666128507097,153.3511198045237,682
54000,-3178.40673828125,309.7085792320148,152.94065454850175,681
55000,-3078.410888671875,306.5856397639294,153.7837242107676,679
56000,-3115.92236328125,313.06766546869636,151.96553426237358,678
57000,-3112.86669921875,307.88280624752576,151.66837533343082,678
58000,-3350.757080078125,317.4928445252218,149.93140945617438,676
59000,-3119.8427734375,301.5432656423632,153.63852149589025,674
60000,-3099.111328125,304.16718443278126,157.00929518595655,670
61000,-3029.989013671875,305.5084019305884,156.908485836683,670
62000,-3159.145263671875,310.9742098333687,153.90360261610758,670
63000,-3122.4853515625,313.8566009005241,154.16403424292062,669
64000,-3102.88623046875,318.05293753609993,152.6325878428767,670
65000,-3174.193115234375,313.31148772433824,153.2000406220117,671
66000,-3150.25146484375,307.8944321803099,156.35209583434252,672
67000,-3111.649169921875,310.2161733009433,153.3931228026114,674
68000,-3064.90869140625,308.1185115335678,154.47906490680788,674
69000,-3107.314453125,314.2226441187978,158.47411143390255,674
70000,-3020.36669921875,312.8071934702927,157.91053181231752,674
71000,-2915.658935546875,314.3003198591404,158.6898914328477,676
72000,-2982.724609375,321.3533961423947,157.8584424606822,677
73000,-2993.283935546875,321.6774788462723,155.41351035702309,678
74000,-2958.010986328125,318.93175837874475,157.91788898881128,678
75000,-3051.702880859375,318.42951885216286,157.48571267645266,679
76000,-2923.89306640625,305.11767557968307,156.4514785054374,680
77000,-2974.4990234375,306.5367243491593,160.3551099114306,679
78000,-3047.22021484375,306.0771864505819,157.94235644004854,678
79000,-3165.8349609375,305.71471397570383,152.0875388951903,677
80000,-3296.365478515625,309.95971729495164,148.9298681726276,677
81000,-3283.8798828125,309.73738877238293,151.35860837380065,676
82000,-3100.02490234375,292.8003349870861,157.51971469678924,674
83000,-3257.4453125,304.68531198358164,153.81058752207832,673
84000,-3231.6474609375,310.0404361112034,150.90510791929688,672
85000,-3145.6240234375,307.5033965192968,153.2782580280336,671
86000,-3214.52294921875,319.09915644248554,151.83007815204505,669
87000,-3218.677734375,317.28295016042006,150.82525814455423,668
88000,-3302.59228515625,319.6713106386491,151.79410226860819,667
89000,-3147.118408203125,310.6033133316036,152.1655106684356,666
90000,-3246.8740234375,310.14530159966756,151.2346444030287,667
91000,-3209.808837890625,306.74162854886487,150.17269011389885,668
92000,-3243.70068359375,306.5829723467821,146.6921216035493,668
93000,-3276.2587890625,307.24945198497886,147.8624787966208,669
94000,-3287.388916015625,317.2650315294048,148.32022445617525,669
95000,-3130.58935546875,302.3975100257787,151.06547142013616,668
96000,-3104.04248046875,300.41556443930267,154.17320423925096,668
97000,-3246.49267578125,306.18753227541663,147.45068295808045,669
98000,-3310.83642578125,317.5655163341493,150.5140459515414,669
99000,-3089.177734375,298.15170496697965,156.55254032343626,670
100000,-3332.8876953125,313.1646673624205,153.56280187500843,670
101000,-3228.376708984375,299.9204040863644,156.1136791113453,670
102000,-3369.59033203125,308.1169559210054,149.28130652753856,670
103000,-3327.7177734375,288.62873353467984,148.83696334740617,671
104000,-3511.173828125,296.1635038932168,146.49862081363338,671
105000,-3465.52587890625,297.8163413025938,145.32428207096052,670
106000,-3553.03857421875,312.52290924248274,144.98710882745706,670
107000,-3371.2021484375,296.193638173217,150.1696419692844,670
108000,-3450.92626953125,294.6664424358834,147.3674255651175,670
109000,-3472.06787109375,295.36016825585796,144.40580488044853,671
110000,-3406.15771484375,295.70452258307296,145.63809854730596,671
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">/var/folders/3h/w4n54dz57dvbhgvz68gdv0f0f3hkmm/T/ipykernel_64115/607502326.py</span> in <span class="ni">&lt;cell line: 26&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">26</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;equilibrated_config.pdb&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span>     <span class="n">state</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">getState</span><span class="p">(</span><span class="n">getPositions</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">enforcePeriodicBox</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">28</span>     <span class="n">topology</span><span class="o">.</span><span class="n">setPeriodicBoxVectors</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">getPeriodicBoxVectors</span><span class="p">())</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span>     <span class="n">app</span><span class="o">.</span><span class="n">PDBFile</span><span class="o">.</span><span class="n">writeFile</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">getPositions</span><span class="p">(),</span> <span class="n">f</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;topology&#39; is not defined
</pre></div>
</div>
</div>
</div>
<section id="visualize-simulation">
<h2>Visualize Simulation<a class="headerlink" href="#visualize-simulation" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Animation</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">py3Dmol</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>

<span class="n">view</span><span class="o">.</span><span class="n">addModelsAsFrames</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;ljtraj.pdb&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span><span class="s1">&#39;pdb&#39;</span><span class="p">)</span>
<span class="n">view</span><span class="o">.</span><span class="n">setBackgroundColor</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">view</span><span class="o">.</span><span class="n">setStyle</span><span class="p">({</span><span class="s1">&#39;sphere&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;green&#39;</span><span class="p">}})</span> 

<span class="c1">#</span>
<span class="n">view</span><span class="o">.</span><span class="n">zoomTo</span><span class="p">()</span>
<span class="n">view</span><span class="o">.</span><span class="n">animate</span><span class="p">({</span><span class="s1">&#39;loop&#39;</span><span class="p">:</span> <span class="s2">&quot;forward&quot;</span><span class="p">})</span>
<span class="n">view</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">mdtraj</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">md</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">nglview</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nv</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">display</span>

<span class="c1"># Load trajectory with PSF as topology</span>
<span class="n">traj</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;traj.dcd&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;equilibrated_config.pdb&#39;</span><span class="p">)</span>

<span class="c1"># Visualize with connectivity</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">nv</span><span class="o">.</span><span class="n">show_mdtraj</span><span class="p">(</span><span class="n">traj</span><span class="p">)</span>
<span class="n">view</span><span class="o">.</span><span class="n">add_representation</span><span class="p">(</span><span class="s1">&#39;ball+stick&#39;</span><span class="p">,</span> <span class="n">selection</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>  <span class="c1"># or &#39;licorice&#39;</span>

<span class="c1"># Display the viewer</span>
<span class="n">display</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "431d4cc2825f4707b1c2987f6fe73fa3", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "a3bc4883df9a4f2bacd1a5eb71fbef38", "version_major": 2, "version_minor": 0}</script></div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "DPotoyan/Statmech4ChemBio",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./labs/lab6"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="openmm_double_well.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Double Well potential using OpenMM</p>
      </div>
    </a>
    <a class="right-next"
       href="openmm_ethane.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Simulating Ethane</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Create Structure and Topology objects</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-the-force-field">Defining the force field</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#option-1-defining-a-force-field-using-the-python-api">Option-1: Defining a force-field using the Python API</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#option-2-creating-a-force-field-xml-file">Option-2” Creating a force-field xml file</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-the-system">Create the system</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-and-run-the-simulation">Setup and run the simulation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-simulation">Visualize Simulation</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Davit Potoyan
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2021.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>